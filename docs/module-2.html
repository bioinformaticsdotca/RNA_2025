<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 2 | RNA-seq Analysis 2025</title>
  <meta name="description" content="Workshop website for the 2025 RNA-seq Analysis Canadian Bioinformatics Workshop" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 2 | RNA-seq Analysis 2025" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://bioinformaticsdotca.github.io/RNA_2025/img/bioinformatics_logo.png" />
  <meta property="og:description" content="Workshop website for the 2025 RNA-seq Analysis Canadian Bioinformatics Workshop" />
  <meta name="github-repo" content="bioinformaticsdotca/RNA_2025" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 2 | RNA-seq Analysis 2025" />
  
  <meta name="twitter:description" content="Workshop website for the 2025 RNA-seq Analysis Canadian Bioinformatics Workshop" />
  <meta name="twitter:image" content="https://bioinformaticsdotca.github.io/RNA_2025/img/bioinformatics_logo.png" />

<meta name="author" content="Faculty: Malachi Griffith and Obi Griffith" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
<link rel="prev" href="module-1.html"/>
<link rel="next" href="module-3.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<a href="https://bioinformaticsdotca.github.io/">
 <img src="img/bioinformatics_logo.png" width="90%" alt="bioinformatics.ca logo" style="display:block; margin-left:auto; margin-right:auto; margin-top:15px;">
 </a>
<li><center><strong><a href="./"><br>RNA-Seq Analysis<br><br></a></strong></center></li>
<a href="./">
 <img src="img/CBW_RNA_Icon.png" width="70%" alt="WORKSHOP NAME logo" style="display:block; margin-left:auto; margin-right:auto; ">
 </a>
<br>

<li class="divider"></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Workshop Info</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#class-photo"><i class="fa fa-check"></i>Class Photo</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pre-work"><i class="fa fa-check"></i>Pre-work</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="meet-your-faculty.html"><a href="meet-your-faculty.html"><i class="fa fa-check"></i>Meet Your Faculty</a></li>
<li class="part"><span><b>II Modules</b></span></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html"><i class="fa fa-check"></i>Module 0: Introductions and Environment Setup</a>
<ul>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#lecture"><i class="fa fa-check"></i>Lecture</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#environment-setup"><i class="fa fa-check"></i>Environment Setup</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#tool-installation"><i class="fa fa-check"></i>Tool Installation</a>
<ul>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#note"><i class="fa fa-check"></i>Note</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#samtools"><i class="fa fa-check"></i>SAMtools</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#bam-readcount"><i class="fa fa-check"></i>bam-readcount</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#hisat2"><i class="fa fa-check"></i>HISAT2</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#stringtie"><i class="fa fa-check"></i>StringTie</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#gffcompare"><i class="fa fa-check"></i>gffcompare</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#htseq-count"><i class="fa fa-check"></i>htseq-count</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#tophat"><i class="fa fa-check"></i>TopHat</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#kallisto"><i class="fa fa-check"></i>kallisto</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#fastqc"><i class="fa fa-check"></i>FastQC</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#fastp"><i class="fa fa-check"></i>Fastp</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#multiqc"><i class="fa fa-check"></i>MultiQC</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#picard"><i class="fa fa-check"></i>Picard</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#regtools"><i class="fa fa-check"></i>RegTools</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#rseqc"><i class="fa fa-check"></i>RSeQC</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#bedops"><i class="fa fa-check"></i>bedops</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#gtftogenepred"><i class="fa fa-check"></i>gtfToGenePred</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#genepredtobed"><i class="fa fa-check"></i>genePredToBed</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#how_are_we_stranded_here"><i class="fa fa-check"></i>how_are_we_stranded_here</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#install-cell-ranger"><i class="fa fa-check"></i>Install Cell Ranger</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#install-r"><i class="fa fa-check"></i>Install R</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#r-libraries"><i class="fa fa-check"></i>R Libraries</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#bioconductor"><i class="fa fa-check"></i>Bioconductor</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#sleuth"><i class="fa fa-check"></i>Sleuth</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#practical-exercise-1---software-installation"><i class="fa fa-check"></i>PRACTICAL EXERCISE 1 - Software Installation</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#add-locally-installed-tools-to-your-path-optional"><i class="fa fa-check"></i>Add locally installed tools to your PATH [OPTIONAL]</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#installing-tools-from-official-ubuntu-packages-optional"><i class="fa fa-check"></i>Installing tools from official ubuntu packages [OPTIONAL]</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#installing-tools-by-docker-image"><i class="fa fa-check"></i>Installing tools by Docker image</a></li>
<li class="chapter" data-level="" data-path="module-0-introductions-and-environment-setup.html"><a href="module-0-introductions-and-environment-setup.html#installing-tools-by-docker-image-using-singularity"><i class="fa fa-check"></i>Installing tools by Docker image (using Singularity)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html"><i class="fa fa-check"></i>Module 1</a>
<ul>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#lecture-1"><i class="fa fa-check"></i>Lecture</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#labs"><i class="fa fa-check"></i>Labs</a>
<ul>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#module-1---key-concepts"><i class="fa fa-check"></i>Module 1 - Key concepts</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#module-1---learning-objectives"><i class="fa fa-check"></i>Module 1 - Learning objectives</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#lecture-2"><i class="fa fa-check"></i>Lecture</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#fastafastqgtf-mini-lecture"><i class="fa fa-check"></i>FASTA/FASTQ/GTF mini lecture</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#obtain-a-reference-genome-from-ensembl-igenomes-ncbi-or-ucsc."><i class="fa fa-check"></i>Obtain a reference genome from Ensembl, iGenomes, NCBI or UCSC.</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#note-on-complex-commands-and-scripting-in-unix"><i class="fa fa-check"></i>Note on complex commands and scripting in Unix</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#practical-exercise-2-advanced"><i class="fa fa-check"></i>PRACTICAL EXERCISE 2 (ADVANCED)</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#fastafastqgtf-mini-lecture-1"><i class="fa fa-check"></i>FASTA/FASTQ/GTF mini lecture</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#obtain-known-genetranscript-annotations"><i class="fa fa-check"></i>Obtain Known Gene/Transcript Annotations</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#definitions"><i class="fa fa-check"></i>Definitions:</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#the-purpose-of-gene-annotations-.gtf-file"><i class="fa fa-check"></i>The Purpose of Gene Annotations (.gtf file)</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#sources-for-obtaining-gene-annotation-files-formatted-for-hisat2stringtieballgown"><i class="fa fa-check"></i>Sources for obtaining gene annotation files formatted for HISAT2/StringTie/Ballgown</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#important-notes"><i class="fa fa-check"></i>Important notes:</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#indexing-mini-lecture"><i class="fa fa-check"></i>Indexing mini lecture</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#create-a-hisat2-index"><i class="fa fa-check"></i>Create a HISAT2 index</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#obtain-rna-seq-test-data."><i class="fa fa-check"></i>Obtain RNA-seq test data.</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#determining-the-strandedness-of-rna-seq-data-optional"><i class="fa fa-check"></i>Determining the strandedness of RNA-seq data (Optional)</a></li>
<li class="chapter" data-level="" data-path="module-1.html"><a href="module-1.html#practical-exercise-3"><i class="fa fa-check"></i>PRACTICAL EXERCISE 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html"><i class="fa fa-check"></i>Module 2</a>
<ul>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#lecture-3"><i class="fa fa-check"></i>Lecture</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#labs-1"><i class="fa fa-check"></i>Labs</a>
<ul>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#module-2---key-concepts"><i class="fa fa-check"></i>Module 2 - Key concepts</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#module-2---learning-objectives"><i class="fa fa-check"></i>Module 2 - Learning objectives</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#lectures"><i class="fa fa-check"></i>Lectures</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#read-trimming-with-fastp"><i class="fa fa-check"></i>Read trimming with Fastp</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#use-fastqc-and-multiqc-to-compare-the-impact-of-trimming"><i class="fa fa-check"></i>Use FastQC and multiqc to compare the impact of trimming</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#clean-up"><i class="fa fa-check"></i>Clean up</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#practical-exercise-5"><i class="fa fa-check"></i>PRACTICAL EXERCISE 5</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#alignment-mini-lecture"><i class="fa fa-check"></i>Alignment mini lecture</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#hisat2-alignment"><i class="fa fa-check"></i>HISAT2 alignment</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#merge-hisat2-bam-files"><i class="fa fa-check"></i>Merge HISAT2 BAM files</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#practical-exercise-6"><i class="fa fa-check"></i>PRACTICAL EXERCISE 6</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#visualization-part-1-getting-familiar-with-igv"><i class="fa fa-check"></i>Visualization Part 1: Getting familiar with IGV</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#visualization-part-2-inspecting-snps-snvs-and-svs"><i class="fa fa-check"></i>Visualization Part 2: Inspecting SNPs, SNVs, and SVs</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#visualization-part-3-automating-tasks-in-igv"><i class="fa fa-check"></i>Visualization Part 3: Automating Tasks in IGV</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#indexing-bam-files-with-samtools"><i class="fa fa-check"></i>Indexing BAM files with samtools</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#visualize-alignments-with-igv"><i class="fa fa-check"></i>Visualize alignments with IGV</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#practical-exercise-7"><i class="fa fa-check"></i>PRACTICAL EXERCISE 7</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#bam-read-counting"><i class="fa fa-check"></i>BAM Read Counting</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#practical-exercise-7-1"><i class="fa fa-check"></i>PRACTICAL EXERCISE 7</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#alignment-qc-mini-lecture"><i class="fa fa-check"></i>Alignment QC mini lecture</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#use-samtools-and-fastqc-to-evaluate-the-alignments"><i class="fa fa-check"></i>Use samtools and FastQC to evaluate the alignments</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#create-versions-of-our-bam-files-with-only-the-chromosome-22-alignments"><i class="fa fa-check"></i>Create versions of our BAM files with only the chromosome 22 alignments</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#using-fastqc"><i class="fa fa-check"></i>Using FastQC</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#using-picard"><i class="fa fa-check"></i>Using Picard</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#rseqc-optional"><i class="fa fa-check"></i>RSeQC [optional]</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#multiqc-1"><i class="fa fa-check"></i>MultiQC</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#view-a-pre-generated-multiqc-report-for-full-bam-files"><i class="fa fa-check"></i>View a pre-generated MultiQC report for full bam files</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#part-i---obtaining-the-dataset-reference-files"><i class="fa fa-check"></i>Part I - Obtaining the dataset &amp; reference files</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#part-ii---data-preprocessing-qc-trimming"><i class="fa fa-check"></i>Part II - Data Preprocessing (QC &amp; Trimming)</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#part-iii---alignment"><i class="fa fa-check"></i>Part III - Alignment</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#part-iv---post-alignment-qc-igv-visualization"><i class="fa fa-check"></i>Part IV - Post-alignment QC &amp; IGV Visualization</a></li>
<li class="chapter" data-level="" data-path="module-2.html"><a href="module-2.html#presenting-your-results"><i class="fa fa-check"></i>Presenting Your Results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html"><i class="fa fa-check"></i>Module 3</a>
<ul>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#labs-2"><i class="fa fa-check"></i>Labs</a>
<ul>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#module-3---key-concepts"><i class="fa fa-check"></i>Module 3 - Key concepts</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#module-3---learning-objectives"><i class="fa fa-check"></i>Module 3 - Learning objectives</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#lectures-1"><i class="fa fa-check"></i>Lectures</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#expression-mini-lecture"><i class="fa fa-check"></i>Expression mini lecture</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#use-stringtie-to-generate-expression-estimates-from-the-sambam-files-generated-by-hisat2-in-the-previous-module"><i class="fa fa-check"></i>Use Stringtie to generate expression estimates from the SAM/BAM files generated by HISAT2 in the previous module</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#practical-exercise-8"><i class="fa fa-check"></i>PRACTICAL EXERCISE 8</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#differential-expression-mini-lecture"><i class="fa fa-check"></i>Differential Expression mini lecture</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#ballgown-de-analysis"><i class="fa fa-check"></i>Ballgown DE Analysis</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#practical-exercise-9"><i class="fa fa-check"></i>PRACTICAL EXERCISE 9</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#ercc-de-analysis"><i class="fa fa-check"></i>ERCC DE Analysis</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#differential-expression-mini-lecture-1"><i class="fa fa-check"></i>Differential Expression mini lecture</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#edger-de-analysis"><i class="fa fa-check"></i>edgeR DE Analysis</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#differential-expression-mini-lecture-2"><i class="fa fa-check"></i>Differential Expression mini lecture</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#deseq2-de-analysis"><i class="fa fa-check"></i>DESeq2 DE Analysis</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#setup"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#format-htseq-counts-data-to-work-with-deseq2"><i class="fa fa-check"></i>Format htseq counts data to work with DESeq2</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#filter-raw-counts"><i class="fa fa-check"></i>Filter raw counts</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#specifying-the-experimental-design"><i class="fa fa-check"></i>Specifying the experimental design</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#construct-the-deseq2-object-piecing-all-the-data-together"><i class="fa fa-check"></i>Construct the DESeq2 object piecing all the data together</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#running-deseq2"><i class="fa fa-check"></i>Running DESeq2</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#log-fold-change-shrinkage"><i class="fa fa-check"></i>Log-fold change shrinkage</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#annotate-gene-symbols-onto-the-de-results"><i class="fa fa-check"></i>Annotate gene symbols onto the DE results</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#data-manipulation"><i class="fa fa-check"></i>Data manipulation</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#save-results-to-files"><i class="fa fa-check"></i>Save results to files</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#briefly-examine-the-top-over-expressed-genes"><i class="fa fa-check"></i>Briefly examine the top over-expressed genes</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#perform-some-preliminary-exploration-of-de-genes-using-webtools"><i class="fa fa-check"></i>Perform some preliminary exploration of DE genes using webtools</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#visualize-overlap-with-a-venn-diagram.-this-can-be-done-with-simple-web-tools-like"><i class="fa fa-check"></i>Visualize overlap with a venn diagram. This can be done with simple web tools like:</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#ballgown-de-visualization"><i class="fa fa-check"></i>Ballgown DE Visualization</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#differential-expression-visualization"><i class="fa fa-check"></i>Differential Expression Visualization</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#viewing-pairwise-sample-clustering"><i class="fa fa-check"></i>Viewing pairwise sample clustering</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#part-i---expression-estimation"><i class="fa fa-check"></i>Part I - Expression Estimation</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#part-ii---differential-expression"><i class="fa fa-check"></i>Part II - Differential Expression</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#presenting-your-results-1"><i class="fa fa-check"></i>Presenting Your Results</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#part-0-obtaining-data-and-references"><i class="fa fa-check"></i>PART 0 : Obtaining Data and References</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#part-1-data-preprocessing"><i class="fa fa-check"></i>Part 1 : Data preprocessing</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#part-2-data-alignment"><i class="fa fa-check"></i>Part 2: Data alignment</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#part-3-expression-estimation"><i class="fa fa-check"></i>Part 3: Expression Estimation</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#part-4-differential-expression-analysis"><i class="fa fa-check"></i>Part 4: Differential Expression Analysis</a></li>
<li class="chapter" data-level="" data-path="module-3.html"><a href="module-3.html#part-5-differential-expression-analysis-visualization"><i class="fa fa-check"></i>Part 5: Differential Expression Analysis Visualization</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<h1 id="sponsors">Sponsors</h1>
<center>
<a href="https://www.cihr-irsc.gc.ca"><img src="img/sponsors/cihr.png" width=90% style="padding-bottom: 20px" alt="Canadian Institutes of Health Research logo."></a>

<a href="https://genomecanada.ca/"><img src="img/sponsors/genomecanada.png" height="70" style="display:inline-block;"  style="padding-bottom: 20px" alt="Genome Canada logo.">
<a href="https://www.ontariogenomics.ca/"><img src="img/sponsors/ontariogenomics.png" height="70" style="display:inline-block;" style="padding-bottom: 20px;" alt="Ontario Genomics logo.">
<br><br>
<a href="https://oicr.on.ca/"><img src="img/sponsors/oicr.png" width=25% style="display:inline-block;" style="padding-bottom: 20px" alt="Ontario Institute for Cancer Research logo.">
<a href="https://www.hpcforhealth.ca/"><img src="img/sponsors/hpc4health.png" width=60% style="display:inline-block;" style="padding-bottom: 20px "alt="HPC4Health logo.">

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">RNA-seq Analysis 2025</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="module-2" class="section level1 hasAnchor">
<h1>Module 2<a href="module-2.html#module-2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="lecture-3" class="section level2 hasAnchor">
<h2>Lecture<a href="module-2.html#lecture-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<iframe src="https://drive.google.com/file/d/1mq6bvyuTsZCa-U2qr-Otgm3-4DJA6uYS/preview" width="640" height="480" allow="autoplay">
</iframe>
</div>
<div id="labs-1" class="section level2 hasAnchor">
<h2>Labs<a href="module-2.html#labs-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://rnabio.org/module-02-alignment/0002/01/01/Intro_to_Alignment/">Module 2 Labs</a></p>
<div id="module-2---key-concepts" class="section level3 hasAnchor">
<h3>Module 2 - Key concepts<a href="module-2.html#module-2---key-concepts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Splice-aware alignment, SAM/BAM format, SAM flags, CIGAR strings, SAM sorting, etc.</li>
</ul>
</div>
<div id="module-2---learning-objectives" class="section level3 hasAnchor">
<h3>Module 2 - Learning objectives<a href="module-2.html#module-2---learning-objectives" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>RNA-seq alignment challenges and common questions</li>
<li>Alignment strategies</li>
<li>HISAT2</li>
<li>Introduction to the BAM and BED formats</li>
<li>Basic manipulation of BAMs</li>
<li>Visualization of RNA-seq alignments in IGV</li>
<li>Alignment QC Assessment</li>
<li>BAM read counting and determination of variant allele expression status</li>
</ul>
</div>
<div id="lectures" class="section level3 hasAnchor">
<h3>Lectures<a href="module-2.html#lectures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><a href="https://github.com/griffithlab/rnabio.org/blob/master/assets/lectures/cbw/2025/mini/RNASeq_MiniLecture_02_01_Alignment.pdf">Introduction to alignment mini lecture</a></li>
<li><a href="https://github.com/griffithlab/rnabio.org/blob/master/assets/lectures/cbw/2025/mini/RNASeq_MiniLecture_02_02_Alignment_vs_Assembly_vs_Kmer.pdf">Alignment/Assembly/kmer mini lecture</a></li>
<li><a href="https://github.com/griffithlab/rnabio.org/blob/master/assets/lectures/cbw/2025/mini/RNASeq_MiniLecture_02_03_SAM_BAM_BED.pdf">SAM/BAM/BED formats mini lecture</a></li>
<li><a href="https://github.com/griffithlab/rnabio.org/blob/master/assets/lectures/cbw/2025/full/RNASeq_Module2_IGV_Tutorial_Brief.pdf">Introduction to IGV lecture</a></li>
<li><a href="https://github.com/griffithlab/rnabio.org/blob/master/assets/lectures/cbw/2025/mini/RNASeq_MiniLecture_02_04_alignmentQC.pdf">Alignment QC mini lecture</a></li>
</ul>
<hr />
<p><img src="img/module_2/RNA-seq_Flowchart3.png" alt="RNA-seq_Flowchart3" /><br />
</p>
<hr />
<p><strong>[OPTIONAL]</strong></p>
<p>Use Fastp to trim sequence adapter from the read FASTQ files and also perform basic data quality cleanup. The output of this step will be trimmed and filtered FASTQ files for each data set.</p>
<p>Refer to the Fastp project and manual for a more detailed explanation:</p>
<ul>
<li><a href="https://github.com/OpenGene/fastp">https://github.com/OpenGene/fastp</a></li>
</ul>
<p>Fastp basic usage:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb70-1"><a href="module-2.html#cb70-1" tabindex="-1"></a>    <span class="ex">fastp</span> <span class="at">-i</span> in.R1.fq.gz <span class="at">-I</span> in.R2.fq.gz <span class="at">-o</span> out.R1.fq.gz <span class="at">-O</span> out.R2.fq.gz</span></code></pre></div>
<p>The <code>-i</code> and <code>-I</code> parameters specify input R1 and R2 data files (raw data)
The <code>-o</code> and <code>-O</code> parameters specify output R1 and R2 data files (trimmed and quality filtered)
Extra options specified below:</p>
<ul>
<li>‘-l 25’ the minimum read length allowed after trimming is 25bp</li>
<li>‘–adapter_fasta’ the path to the adapter FASTA file containing adapter sequences to trim</li>
<li>‘–trim_front1 13’ trim a fixed number (13 in this case) of bases off the left end of read1</li>
<li>‘–trim_front2 13’ trim a fixed number (13 in this case) of bases off the left end of read2</li>
<li>‘–json’ the path to store a log file in JSON file format</li>
<li>‘–html’ the path to store a web report file</li>
<li>‘2&gt;’ use to store the information that would be printed to the screen into a file instead</li>
</ul>
</div>
<div id="read-trimming-with-fastp" class="section level3 hasAnchor">
<h3>Read trimming with Fastp<a href="module-2.html#read-trimming-with-fastp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, set up some directories for output</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb71-1"><a href="module-2.html#cb71-1" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$RNA_DATA_TRIM_DIR</span></span>
<span id="cb71-2"><a href="module-2.html#cb71-2" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$RNA_DATA_TRIM_DIR</span></span></code></pre></div>
<p>Download necessary Illumina adapter sequence files.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb72-1"><a href="module-2.html#cb72-1" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$RNA_REFS_DIR</span></span>
<span id="cb72-2"><a href="module-2.html#cb72-2" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$RNA_REFS_DIR</span></span>
<span id="cb72-3"><a href="module-2.html#cb72-3" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_REFS_DIR</span></span>
<span id="cb72-4"><a href="module-2.html#cb72-4" tabindex="-1"></a><span class="fu">wget</span> http://genomedata.org/rnaseq-tutorial/illumina_multiplex.fa</span></code></pre></div>
<p>Use fastp to remove illumina adapter sequences (if any), trim the first 13 bases of each read, and perform default read quality filtering to remove reads that are too short, have too many low quality bases or have too many N’s.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb73-1"><a href="module-2.html#cb73-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_HOME</span></span>
<span id="cb73-2"><a href="module-2.html#cb73-2" tabindex="-1"></a></span>
<span id="cb73-3"><a href="module-2.html#cb73-3" tabindex="-1"></a><span class="bu">export</span> <span class="va">S1</span><span class="op">=</span>UHR_Rep1_ERCC-Mix1_Build37-ErccTranscripts-chr22</span>
<span id="cb73-4"><a href="module-2.html#cb73-4" tabindex="-1"></a><span class="ex">fastp</span> <span class="at">-i</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S1</span>.read1.fastq.gz <span class="at">-I</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S1</span>.read2.fastq.gz <span class="at">-o</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S1</span>.read1.fastq.gz <span class="at">-O</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S1</span>.read2.fastq.gz <span class="at">-l</span> 25 <span class="at">--adapter_fasta</span> <span class="va">$RNA_REFS_DIR</span>/illumina_multiplex.fa <span class="at">--trim_front1</span> 13 <span class="at">--trim_front2</span> 13 <span class="at">--json</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S1</span>.fastp.json <span class="at">--html</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S1</span>.fastp.html <span class="dv">2</span><span class="op">&gt;</span><span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S1</span>.fastp.log</span>
<span id="cb73-5"><a href="module-2.html#cb73-5" tabindex="-1"></a></span>
<span id="cb73-6"><a href="module-2.html#cb73-6" tabindex="-1"></a><span class="bu">export</span> <span class="va">S2</span><span class="op">=</span>UHR_Rep2_ERCC-Mix1_Build37-ErccTranscripts-chr22</span>
<span id="cb73-7"><a href="module-2.html#cb73-7" tabindex="-1"></a><span class="ex">fastp</span> <span class="at">-i</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S2</span>.read1.fastq.gz <span class="at">-I</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S2</span>.read2.fastq.gz <span class="at">-o</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S2</span>.read1.fastq.gz <span class="at">-O</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S2</span>.read2.fastq.gz <span class="at">-l</span> 25 <span class="at">--adapter_fasta</span> <span class="va">$RNA_REFS_DIR</span>/illumina_multiplex.fa <span class="at">--trim_front1</span> 13 <span class="at">--trim_front2</span> 13 <span class="at">--json</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S2</span>.fastp.json <span class="at">--html</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S2</span>.fastp.html <span class="dv">2</span><span class="op">&gt;</span><span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S2</span>.fastp.log</span>
<span id="cb73-8"><a href="module-2.html#cb73-8" tabindex="-1"></a></span>
<span id="cb73-9"><a href="module-2.html#cb73-9" tabindex="-1"></a><span class="bu">export</span> <span class="va">S3</span><span class="op">=</span>UHR_Rep3_ERCC-Mix1_Build37-ErccTranscripts-chr22</span>
<span id="cb73-10"><a href="module-2.html#cb73-10" tabindex="-1"></a><span class="ex">fastp</span> <span class="at">-i</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S3</span>.read1.fastq.gz <span class="at">-I</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S3</span>.read2.fastq.gz <span class="at">-o</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S3</span>.read1.fastq.gz <span class="at">-O</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S3</span>.read2.fastq.gz <span class="at">-l</span> 25 <span class="at">--adapter_fasta</span> <span class="va">$RNA_REFS_DIR</span>/illumina_multiplex.fa <span class="at">--trim_front1</span> 13 <span class="at">--trim_front2</span> 13 <span class="at">--json</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S3</span>.fastp.json <span class="at">--html</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S3</span>.fastp.html <span class="dv">2</span><span class="op">&gt;</span><span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S3</span>.fastp.log</span>
<span id="cb73-11"><a href="module-2.html#cb73-11" tabindex="-1"></a></span>
<span id="cb73-12"><a href="module-2.html#cb73-12" tabindex="-1"></a><span class="bu">export</span> <span class="va">S4</span><span class="op">=</span>HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22</span>
<span id="cb73-13"><a href="module-2.html#cb73-13" tabindex="-1"></a><span class="ex">fastp</span> <span class="at">-i</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S4</span>.read1.fastq.gz <span class="at">-I</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S4</span>.read2.fastq.gz <span class="at">-o</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S4</span>.read1.fastq.gz <span class="at">-O</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S4</span>.read2.fastq.gz <span class="at">-l</span> 25 <span class="at">--adapter_fasta</span> <span class="va">$RNA_REFS_DIR</span>/illumina_multiplex.fa <span class="at">--trim_front1</span> 13 <span class="at">--trim_front2</span> 13 <span class="at">--json</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S4</span>.fastp.json <span class="at">--html</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S4</span>.fastp.html <span class="dv">2</span><span class="op">&gt;</span><span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S4</span>.fastp.log</span>
<span id="cb73-14"><a href="module-2.html#cb73-14" tabindex="-1"></a></span>
<span id="cb73-15"><a href="module-2.html#cb73-15" tabindex="-1"></a><span class="bu">export</span> <span class="va">S5</span><span class="op">=</span>HBR_Rep2_ERCC-Mix2_Build37-ErccTranscripts-chr22</span>
<span id="cb73-16"><a href="module-2.html#cb73-16" tabindex="-1"></a><span class="ex">fastp</span> <span class="at">-i</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S5</span>.read1.fastq.gz <span class="at">-I</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S5</span>.read2.fastq.gz <span class="at">-o</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S5</span>.read1.fastq.gz <span class="at">-O</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S5</span>.read2.fastq.gz <span class="at">-l</span> 25 <span class="at">--adapter_fasta</span> <span class="va">$RNA_REFS_DIR</span>/illumina_multiplex.fa <span class="at">--trim_front1</span> 13 <span class="at">--trim_front2</span> 13 <span class="at">--json</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S5</span>.fastp.json <span class="at">--html</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S5</span>.fastp.html <span class="dv">2</span><span class="op">&gt;</span><span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S5</span>.fastp.log</span>
<span id="cb73-17"><a href="module-2.html#cb73-17" tabindex="-1"></a></span>
<span id="cb73-18"><a href="module-2.html#cb73-18" tabindex="-1"></a><span class="bu">export</span> <span class="va">S6</span><span class="op">=</span>HBR_Rep3_ERCC-Mix2_Build37-ErccTranscripts-chr22</span>
<span id="cb73-19"><a href="module-2.html#cb73-19" tabindex="-1"></a><span class="ex">fastp</span> <span class="at">-i</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S6</span>.read1.fastq.gz <span class="at">-I</span> <span class="va">$RNA_DATA_DIR</span>/<span class="va">$S6</span>.read2.fastq.gz <span class="at">-o</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S6</span>.read1.fastq.gz <span class="at">-O</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S6</span>.read2.fastq.gz <span class="at">-l</span> 25 <span class="at">--adapter_fasta</span> <span class="va">$RNA_REFS_DIR</span>/illumina_multiplex.fa <span class="at">--trim_front1</span> 13 <span class="at">--trim_front2</span> 13 <span class="at">--json</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S6</span>.fastp.json <span class="at">--html</span> <span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S6</span>.fastp.html <span class="dv">2</span><span class="op">&gt;</span><span class="va">$RNA_DATA_TRIM_DIR</span>/<span class="va">$S6</span>.fastp.log</span></code></pre></div>
</div>
<div id="use-fastqc-and-multiqc-to-compare-the-impact-of-trimming" class="section level3 hasAnchor">
<h3>Use FastQC and multiqc to compare the impact of trimming<a href="module-2.html#use-fastqc-and-multiqc-to-compare-the-impact-of-trimming" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Optional exercise: Compare the FastQC reports for fastq files before and after trimming. All fastqc reports can be generated on the commandline.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb74-1"><a href="module-2.html#cb74-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_DATA_TRIM_DIR</span></span>
<span id="cb74-2"><a href="module-2.html#cb74-2" tabindex="-1"></a><span class="ex">fastqc</span> <span class="pp">*</span>.fastq.gz</span>
<span id="cb74-3"><a href="module-2.html#cb74-3" tabindex="-1"></a></span>
<span id="cb74-4"><a href="module-2.html#cb74-4" tabindex="-1"></a><span class="ex">multiqc</span> ./</span></code></pre></div>
<p>The resulting html reports can be viewed by navigating to:</p>
<ul>
<li><a href="http://" class="uri">http://</a><strong>YOUR_PUBLIC_IPv4_ADDRESS</strong>/rnaseq/data/</li>
<li><a href="http://" class="uri">http://</a><strong>YOUR_PUBLIC_IPv4_ADDRESS</strong>/rnaseq/data/trimmed/</li>
</ul>
</div>
<div id="clean-up" class="section level3 hasAnchor">
<h3>Clean up<a href="module-2.html#clean-up" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Move the fastqc and fastp results into sub-directories to keep things tidy</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb75-1"><a href="module-2.html#cb75-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_DATA_TRIM_DIR</span></span>
<span id="cb75-2"><a href="module-2.html#cb75-2" tabindex="-1"></a><span class="fu">mkdir</span> fastqc</span>
<span id="cb75-3"><a href="module-2.html#cb75-3" tabindex="-1"></a><span class="fu">mv</span> <span class="pp">*</span>_fastqc<span class="pp">*</span> fastqc</span>
<span id="cb75-4"><a href="module-2.html#cb75-4" tabindex="-1"></a><span class="fu">mkdir</span> fastp</span>
<span id="cb75-5"><a href="module-2.html#cb75-5" tabindex="-1"></a><span class="fu">mv</span> <span class="pp">*</span>fastp.<span class="pp">*</span> fastp</span></code></pre></div>
<hr />
</div>
<div id="practical-exercise-5" class="section level3 hasAnchor">
<h3>PRACTICAL EXERCISE 5<a href="module-2.html#practical-exercise-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Assignment: Using the approach above, trim the reads for both normal and tumor samples that you downloaded for the previous practical exercise. NOTE: try dropping the hard left trim option used above (‘–trim_front1 13’ and ‘–trim_front2 13’). Once you have trimmed the reads, compare a pre- and post- trimming FastQ file using the FastQC and multiqc tools.</p>
<ul>
<li>Hint: These files should have been downloaded to $RNA_HOME/practice/data/.</li>
</ul>
<p><strong>Questions</strong></p>
<p>Answer these questions by examining the FastQC reports:</p>
<ul>
<li>After trimming, what is the range of read lengths observed for hcc1395 normal replicate 1, read 1?</li>
<li>Which sections of the FastQC report are most informative for observing the effect of trimming?</li>
<li>In the ‘Per base sequence content section’, what pattern do you see? What could explain this pattern?</li>
</ul>
<p>Solution: When you are ready you can check your approach against the <a href="/module-09-appendix/0009/05/01/Practical_Exercise_Solutions/#practical-exercise-5---trim">Solutions</a>.</p>
</div>
<div id="alignment-mini-lecture" class="section level3 hasAnchor">
<h3>Alignment mini lecture<a href="module-2.html#alignment-mini-lecture" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you would like a refresher on alignment, we have created an <a href="https://github.com/griffithlab/rnabio.org/blob/master/assets/lectures/cbw/2025/mini/RNASeq_MiniLecture_02_01_Alignment.pdf">alignment mini lecture</a>.</p>
<p>We have also provided a mini lectures describing the differences between <a href="https://github.com/griffithlab/rnabio.org/blob/master/assets/lectures/cbw/2025/mini/RNASeq_MiniLecture_02_02_Alignment_vs_Assembly_vs_Kmer.pdf">alignment, assembly, and pseudoalignment</a> and describing <a href="https://github.com/griffithlab/rnabio.org/blob/master/assets/lectures/cbw/2025/mini/RNASeq_MiniLecture_02_03_SAM_BAM_BED.pdf">sam, bam, and bed file formats</a>.</p>
</div>
<div id="hisat2-alignment" class="section level3 hasAnchor">
<h3>HISAT2 alignment<a href="module-2.html#hisat2-alignment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Perform alignments with HISAT2 to the genome and transcriptome.</p>
<p>First, begin by making the appropriate output directory for our alignment results.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb76-1"><a href="module-2.html#cb76-1" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb76-2"><a href="module-2.html#cb76-2" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb76-3"><a href="module-2.html#cb76-3" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span></span></code></pre></div>
<p>HISAT2 uses a graph-based alignment and has succeeded HISAT and TOPHAT2. The output of this step will be a SAM/BAM file for each data set.</p>
<p>Refer to HISAT2 manual for a more detailed explanation:</p>
<ul>
<li><a href="http://daehwankimlab.github.io/hisat2/manual/">http://daehwankimlab.github.io/hisat2/manual/</a></li>
</ul>
<p>HISAT2 basic usage:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb77-1"><a href="module-2.html#cb77-1" tabindex="-1"></a><span class="co">#hisat2 [options]* -x &lt;ht2-idx&gt; {-1 &lt;m1&gt; -2 &lt;m2&gt; | -U &lt;r&gt; | --sra-acc &lt;SRA accession number&gt;} [-S &lt;sam&gt;]</span></span></code></pre></div>
<p>Extra options specified below:</p>
<ul>
<li>‘-p 4’ tells HISAT2 to use 4 CPUs for bowtie alignments.</li>
<li>‘–rna-strandness RF’ specifies strandness of RNAseq library. We will specify RF since the TruSeq strand-specific library was used to make these libraries. See here for options.</li>
<li>‘–rg-id $ID’ specifies a read group ID that is a unique identifier.</li>
<li>‘–rg SM:$SAMPLE_NAME’ specifies a read group sample name. This together with rg-id will allow you to determine which reads came from which sample in the merged bam later on.</li>
<li>‘–rg LB:$LIBRARY_NAME’ specifies a read group library name. This together with rg-id will allow you to determine which reads came from which library in the merged bam later on.</li>
<li>‘–rg PL:ILLUMINA’ specifies a read group sequencing platform.</li>
<li>‘–rg PU:$PLATFORM_UNIT’ specifies a read group sequencing platform unit. Typically this consists of FLOWCELL-BARCODE.LANE</li>
<li>‘–dta’ Reports alignments tailored for transcript assemblers.</li>
<li>‘-x /path/to/hisat2/index’ The HISAT2 index filename prefix (minus the trailing .X.ht2) built earlier including splice sites and exons.</li>
<li>‘-1 /path/to/read1.fastq.gz’ The read 1 FASTQ file, optionally gzip(.gz) or bzip2(.bz2) compressed.</li>
<li>‘-2 /path/to/read2.fastq.gz’ The read 2 FASTQ file, optionally gzip(.gz) or bzip2(.bz2) compressed.</li>
<li>‘-S /path/to/output.sam’ The output SAM format text file of alignments.</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb78-1"><a href="module-2.html#cb78-1" tabindex="-1"></a><span class="ex">hisat2</span> <span class="at">-p</span> 4 <span class="at">--rg-id</span><span class="op">=</span>UHR_Rep1 <span class="at">--rg</span> SM:UHR <span class="at">--rg</span> LB:UHR_Rep1_ERCC-Mix1 <span class="at">--rg</span> PL:ILLUMINA <span class="at">--rg</span> PU:CXX1234-ACTGAC.1 <span class="at">-x</span> <span class="va">$RNA_REF_INDEX</span> <span class="at">--dta</span> <span class="at">--rna-strandness</span> RF <span class="at">-1</span> <span class="va">$RNA_DATA_DIR</span>/UHR_Rep1_ERCC-Mix1_Build37-ErccTranscripts-chr22.read1.fastq.gz <span class="at">-2</span> <span class="va">$RNA_DATA_DIR</span>/UHR_Rep1_ERCC-Mix1_Build37-ErccTranscripts-chr22.read2.fastq.gz <span class="at">-S</span> ./UHR_Rep1.sam</span>
<span id="cb78-2"><a href="module-2.html#cb78-2" tabindex="-1"></a><span class="ex">hisat2</span> <span class="at">-p</span> 4 <span class="at">--rg-id</span><span class="op">=</span>UHR_Rep2 <span class="at">--rg</span> SM:UHR <span class="at">--rg</span> LB:UHR_Rep2_ERCC-Mix1 <span class="at">--rg</span> PL:ILLUMINA <span class="at">--rg</span> PU:CXX1234-TGACAC.1 <span class="at">-x</span> <span class="va">$RNA_REF_INDEX</span> <span class="at">--dta</span> <span class="at">--rna-strandness</span> RF <span class="at">-1</span> <span class="va">$RNA_DATA_DIR</span>/UHR_Rep2_ERCC-Mix1_Build37-ErccTranscripts-chr22.read1.fastq.gz <span class="at">-2</span> <span class="va">$RNA_DATA_DIR</span>/UHR_Rep2_ERCC-Mix1_Build37-ErccTranscripts-chr22.read2.fastq.gz <span class="at">-S</span> ./UHR_Rep2.sam</span>
<span id="cb78-3"><a href="module-2.html#cb78-3" tabindex="-1"></a><span class="ex">hisat2</span> <span class="at">-p</span> 4 <span class="at">--rg-id</span><span class="op">=</span>UHR_Rep3 <span class="at">--rg</span> SM:UHR <span class="at">--rg</span> LB:UHR_Rep3_ERCC-Mix1 <span class="at">--rg</span> PL:ILLUMINA <span class="at">--rg</span> PU:CXX1234-CTGACA.1 <span class="at">-x</span> <span class="va">$RNA_REF_INDEX</span> <span class="at">--dta</span> <span class="at">--rna-strandness</span> RF <span class="at">-1</span> <span class="va">$RNA_DATA_DIR</span>/UHR_Rep3_ERCC-Mix1_Build37-ErccTranscripts-chr22.read1.fastq.gz <span class="at">-2</span> <span class="va">$RNA_DATA_DIR</span>/UHR_Rep3_ERCC-Mix1_Build37-ErccTranscripts-chr22.read2.fastq.gz <span class="at">-S</span> ./UHR_Rep3.sam</span>
<span id="cb78-4"><a href="module-2.html#cb78-4" tabindex="-1"></a></span>
<span id="cb78-5"><a href="module-2.html#cb78-5" tabindex="-1"></a><span class="ex">hisat2</span> <span class="at">-p</span> 4 <span class="at">--rg-id</span><span class="op">=</span>HBR_Rep1 <span class="at">--rg</span> SM:HBR <span class="at">--rg</span> LB:HBR_Rep1_ERCC-Mix2 <span class="at">--rg</span> PL:ILLUMINA <span class="at">--rg</span> PU:CXX1234-TGACAC.1 <span class="at">-x</span> <span class="va">$RNA_REF_INDEX</span> <span class="at">--dta</span> <span class="at">--rna-strandness</span> RF <span class="at">-1</span> <span class="va">$RNA_DATA_DIR</span>/HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22.read1.fastq.gz <span class="at">-2</span> <span class="va">$RNA_DATA_DIR</span>/HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22.read2.fastq.gz <span class="at">-S</span> ./HBR_Rep1.sam</span>
<span id="cb78-6"><a href="module-2.html#cb78-6" tabindex="-1"></a><span class="ex">hisat2</span> <span class="at">-p</span> 4 <span class="at">--rg-id</span><span class="op">=</span>HBR_Rep2 <span class="at">--rg</span> SM:HBR <span class="at">--rg</span> LB:HBR_Rep2_ERCC-Mix2 <span class="at">--rg</span> PL:ILLUMINA <span class="at">--rg</span> PU:CXX1234-GACACT.1 <span class="at">-x</span> <span class="va">$RNA_REF_INDEX</span> <span class="at">--dta</span> <span class="at">--rna-strandness</span> RF <span class="at">-1</span> <span class="va">$RNA_DATA_DIR</span>/HBR_Rep2_ERCC-Mix2_Build37-ErccTranscripts-chr22.read1.fastq.gz <span class="at">-2</span> <span class="va">$RNA_DATA_DIR</span>/HBR_Rep2_ERCC-Mix2_Build37-ErccTranscripts-chr22.read2.fastq.gz <span class="at">-S</span> ./HBR_Rep2.sam</span>
<span id="cb78-7"><a href="module-2.html#cb78-7" tabindex="-1"></a><span class="ex">hisat2</span> <span class="at">-p</span> 4 <span class="at">--rg-id</span><span class="op">=</span>HBR_Rep3 <span class="at">--rg</span> SM:HBR <span class="at">--rg</span> LB:HBR_Rep3_ERCC-Mix2 <span class="at">--rg</span> PL:ILLUMINA <span class="at">--rg</span> PU:CXX1234-ACACTG.1 <span class="at">-x</span> <span class="va">$RNA_REF_INDEX</span> <span class="at">--dta</span> <span class="at">--rna-strandness</span> RF <span class="at">-1</span> <span class="va">$RNA_DATA_DIR</span>/HBR_Rep3_ERCC-Mix2_Build37-ErccTranscripts-chr22.read1.fastq.gz <span class="at">-2</span> <span class="va">$RNA_DATA_DIR</span>/HBR_Rep3_ERCC-Mix2_Build37-ErccTranscripts-chr22.read2.fastq.gz <span class="at">-S</span> ./HBR_Rep3.sam</span></code></pre></div>
<p>Note: in the above alignments, we are treating each library as an independent data set. If you had multiple lanes of data for a single library, you could align them all together in one HISAT2 command. Similarly you might combine technical replicates into a single alignment run (perhaps after examining them and removing outliers…). To combine multiple lanes, you would provide all the read1 files as a comma separated list for the ‘-1’ input argument, and then all read2 files as a comma separated list for the ‘-2’ input argument, (where both lists have the same order) : You can also use samtools merge to combine bam files after alignment. This is the approach we will take.</p>
<p><strong>HISAT2 Alignment Summary</strong>
HISAT2 generates a summary of the alignments printed to the terminal. Notice the number of total reads, reads aligned and various metrics regarding how the reads aligned to the reference.</p>
<p><strong>SAM to BAM Conversion</strong>
Convert HISAT2 sam files to bam files and sort by aligned position</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb79-1"><a href="module-2.html#cb79-1" tabindex="-1"></a><span class="ex">samtools</span> sort <span class="at">-@</span> 4 <span class="at">-o</span> UHR_Rep1.bam UHR_Rep1.sam</span>
<span id="cb79-2"><a href="module-2.html#cb79-2" tabindex="-1"></a><span class="ex">samtools</span> sort <span class="at">-@</span> 4 <span class="at">-o</span> UHR_Rep2.bam UHR_Rep2.sam</span>
<span id="cb79-3"><a href="module-2.html#cb79-3" tabindex="-1"></a><span class="ex">samtools</span> sort <span class="at">-@</span> 4 <span class="at">-o</span> UHR_Rep3.bam UHR_Rep3.sam</span>
<span id="cb79-4"><a href="module-2.html#cb79-4" tabindex="-1"></a><span class="ex">samtools</span> sort <span class="at">-@</span> 4 <span class="at">-o</span> HBR_Rep1.bam HBR_Rep1.sam</span>
<span id="cb79-5"><a href="module-2.html#cb79-5" tabindex="-1"></a><span class="ex">samtools</span> sort <span class="at">-@</span> 4 <span class="at">-o</span> HBR_Rep2.bam HBR_Rep2.sam</span>
<span id="cb79-6"><a href="module-2.html#cb79-6" tabindex="-1"></a><span class="ex">samtools</span> sort <span class="at">-@</span> 4 <span class="at">-o</span> HBR_Rep3.bam HBR_Rep3.sam</span></code></pre></div>
</div>
<div id="merge-hisat2-bam-files" class="section level3 hasAnchor">
<h3>Merge HISAT2 BAM files<a href="module-2.html#merge-hisat2-bam-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Make a single BAM file combining all UHR data and another for all HBR data. Note: This could be done in several ways such as ‘samtools merge’, ‘bamtools merge’, or using picard-tools (see below). We chose the third method because it did the best job at merging the bam header information. NOTE: sambamba also retains header info.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb80-1"><a href="module-2.html#cb80-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_HOME</span>/alignments/hisat2</span>
<span id="cb80-2"><a href="module-2.html#cb80-2" tabindex="-1"></a><span class="ex">java</span> <span class="at">-Xmx2g</span> <span class="at">-jar</span> <span class="va">$PICARD</span> MergeSamFiles <span class="at">-OUTPUT</span> UHR.bam <span class="at">-INPUT</span> UHR_Rep1.bam <span class="at">-INPUT</span> UHR_Rep2.bam <span class="at">-INPUT</span> UHR_Rep3.bam</span>
<span id="cb80-3"><a href="module-2.html#cb80-3" tabindex="-1"></a><span class="ex">java</span> <span class="at">-Xmx2g</span> <span class="at">-jar</span> <span class="va">$PICARD</span> MergeSamFiles <span class="at">-OUTPUT</span> HBR.bam <span class="at">-INPUT</span> HBR_Rep1.bam <span class="at">-INPUT</span> HBR_Rep2.bam <span class="at">-INPUT</span> HBR_Rep3.bam</span></code></pre></div>
<p>Count the alignment (BAM) files to make sure all were created successfully (you should have 8 total)</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb81-1"><a href="module-2.html#cb81-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> <span class="pp">*</span>.bam <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span></span>
<span id="cb81-2"><a href="module-2.html#cb81-2" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> <span class="pp">*</span>.bam</span></code></pre></div>
<hr />
</div>
<div id="practical-exercise-6" class="section level3 hasAnchor">
<h3>PRACTICAL EXERCISE 6<a href="module-2.html#practical-exercise-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Assignment: Perform some alignments on additional read data sets. Align the reads using the skills you learned above. Try using the HISAT2 aligner. Also practice converting SAM to BAM files, and merging BAM files.</p>
<p>Hint: Do this analysis on the additional data and in the separate working directory called ‘practice’ that you created in Practical Exercise 3.
Questions</p>
<p>What is the difference between a .sam and .bam file?
If you sorted the resulting BAM file as we did above, is the result sorted by read name? Or position?
Which columns of the BAM file can be viewed to determine the style of sorting?
What command can you use to view only the BAM header?</p>
<p>Solution: When you are ready you can check your approach against the <a href="/module-09-appendix/0009/05/01/Practical_Exercise_Solutions/#practical-exercise-6---alignment">Solutions</a>.</p>
<hr />
</div>
<div id="introduction" class="section level3 hasAnchor">
<h3>Introduction<a href="module-2.html#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Description of the lab</strong>
Welcome to the lab for Genome Visualization! This lab will introduce you to the <a href="http://www.broadinstitute.org/igv/">Integrative Genomics Viewer</a>, one of the most popular visualization tools for High Throughput Sequencing (HTS) data.</p>
<p>Lecture files that accompany this tutorial:</p>
<ul>
<li><a href="assets/module_2/IGV_Tutorial_Brief.pdf">IGV Lecture - Brief</a></li>
<li><a href="assets/module_2/IGV_Tutorial_Long_BroadInstitute.pdf">IGV Lecture - Long, from Broad Institute</a></li>
</ul>
<p>After this lab, you will be able to:</p>
<ul>
<li>Visualize a variety of genomic data</li>
<li>Quickly navigate around the genome</li>
<li>Visualize read alignments</li>
<li>Validate SNP/SNV calls and structural re-arrangements by eye</li>
</ul>
<p>Things to know before you start:</p>
<ul>
<li><p>The lab may take between <strong>1-2 hours</strong>, depending on your familiarity with genome browsing. Do not worry if you do not complete the lab. It will remain available to review later.</p></li>
<li><p>There are a few thought-provoking <strong>Questions</strong> or <strong>Notes</strong> pertaining to sections of the lab. These are <strong>optional</strong>, and may take more time, but are meant to help you better understand the visualizations you are seeing. These questions will be denoted by boxes, as follows: <strong>Question(s):</strong></p></li>
</ul>
<p>`Thought-provoking question goes here.``</p>
<div id="requirements" class="section level4 hasAnchor">
<h4>Requirements<a href="module-2.html#requirements" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><a href="https://software.broadinstitute.org/software/igv/">Integrative Genomics Viewer</a></p></li>
<li><p>Ability to run Java</p></li>
<li><p>Note that while most tutorials in this course are performed on the cloud, IGV will always be run on your local machine</p></li>
<li><p>Note a version of this tutorial can also be performed directly in your web browser at <a href="https://sandbox.bio/tutorials?id=igv-intro">sandbox.bio IGV Intro</a>.</p></li>
</ul>
</div>
<div id="compatibility" class="section level4 hasAnchor">
<h4>Compatibility<a href="module-2.html#compatibility" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This tutorial was most recently updated for IGV v2.16.2, which is available on the <a href="http://software.broadinstitute.org/software/igv/download">IGV Download page</a>. It is recommended that you use this version. Most other recent versions will work but their may be slight differences.</p>
</div>
<div id="data-set-for-igv" class="section level4 hasAnchor">
<h4>Data Set for IGV<a href="module-2.html#data-set-for-igv" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We will be using publicly available Illumina sequence data from the HCC1143 cell line. The HCC1143 cell line was generated from a 52 year old caucasian woman with breast cancer. Additional information on this cell line can be found here: <a href="https://www.atcc.org/products/all/CRL-2321.aspx">HCC1143</a> (tumor, TNM stage IIA, grade 3, primary ductal carcinoma) and <a href="https://www.atcc.org/products/all/CRL-2362.aspx">HCC1143/BL</a> (matched normal EBV transformed lymphoblast cell line).</p>
<ul>
<li>Sequence read alignments generated from a cell line HCC1143 that have been filtered to this region:</li>
<li>Chromosome 21: 19,000,000-20,000,000</li>
<li><a href="assets/module_2/HCC1143.normal.21.19M-20M.bam">HCC1143.normal.21.19M-20M.bam</a></li>
<li><a href="assets/module_2/HCC1143.normal.21.19M-20M.bam.bai">HCC1143.normal.21.19M-20M.bam.bai</a></li>
</ul>
<hr />
</div>
</div>
<div id="visualization-part-1-getting-familiar-with-igv" class="section level3 hasAnchor">
<h3>Visualization Part 1: Getting familiar with IGV<a href="module-2.html#visualization-part-1-getting-familiar-with-igv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will be visualizing read alignments using <a href="http://www.broadinstitute.org/igv/">IGV</a>, a popular visualization tool for HTS data.</p>
<p>First, lets familiarize ourselves with it.</p>
<div id="get-familiar-with-the-interface" class="section level4 hasAnchor">
<h4>Get familiar with the interface<a href="module-2.html#get-familiar-with-the-interface" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="load-a-genome-and-some-data-tracks" class="section level5 hasAnchor">
<h5>Load a Genome and some Data Tracks<a href="module-2.html#load-a-genome-and-some-data-tracks" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>By default, IGV loads the Human GRCh38/hg38 reference genome. If you work with another version of the human genome, or another organism altogether, you can change the genome by clicking the drop down menu in the upper-left. For this lab, we will be using Human GRCh37/hg19.</p>
<p>We will also load additional tracks from Server using (<code>File</code> -&gt; <code>Load from Server...</code>):</p>
<ul>
<li>Ensembl Genes (or your favourite source of gene annotations)</li>
<li>GC Percentage</li>
<li>dbSNP 1.4.7</li>
</ul>
<p><strong>Load hg19 genome and additional data tracks</strong></p>
<div class="float">
<img src="assets/module_2/load.data.tracks.png" alt="Load hg19 genome and additional data tracks" />
<div class="figcaption">Load hg19 genome and additional data tracks</div>
</div>
</div>
</div>
<div id="navigation" class="section level4 hasAnchor">
<h4>Navigation<a href="module-2.html#navigation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You should see listing of chromosomes in this reference genome. Choose 1, for chromosome 1.</p>
<p><strong>Chromosome chooser</strong></p>
<div class="float">
<img src="assets/module_2/chromosomes.png" alt="Chromosome chooser" />
<div class="figcaption">Chromosome chooser</div>
</div>
<p>Navigate to <strong>chr1:10,000-11,000</strong> by entering this into the location field (in the top-left corner of the interface) and clicking <code>Go</code>. This shows a window of chromosome 1 that is 1,000 base pairs wide and beginning at position 10,000.</p>
<p><strong>Navigition using Location text field. Sequence displayed as thin coloured rectangles.</strong></p>
<div class="float">
<img src="assets/module_2/1.png" alt="Navigition using Location text field. Sequence displayed as thin coloured rectangles." />
<div class="figcaption">Navigition using Location text field. Sequence displayed as thin coloured rectangles.</div>
</div>
<p>IGV displays the sequence of letters in a genome as a sequence of colours (e.g. A = green, C = blue, etc.). This makes repetitive sequences, like the ones found at the start of this region, easy to identify. Zoom in a bit more using the <code>+</code> button to see the individual bases of the reference genome sequence.</p>
<p>You can navigate to a gene of interest by typing it in the same box the genomic coordinates are in and pressing Enter/Return. Try it for your favourite gene, or BRCA1 if you can not decide.</p>
<p><strong>Gene model</strong></p>
<div class="float">
<img src="assets/module_2/gene_model.png" alt="Gene model" />
<div class="figcaption">Gene model</div>
</div>
<p>Genes are represented as lines and boxes. Lines represent intronic regions, and boxes represent exonic regions. The arrows indicate the direction/strand of transcription for the gene. When an exon box become narrower in height, this indicates a UTR.</p>
<p>When loaded, tracks are stacked on top of each other. You can identify which track is which by consulting the label to the left of each track.</p>
</div>
<div id="region-lists" class="section level4 hasAnchor">
<h4>Region Lists<a href="module-2.html#region-lists" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Sometimes, it is really useful to save where you are, or to load regions of interest. For this purpose, there is a <strong>Region Navigator</strong> in IGV. To access it, click <code>Regions</code> &gt; <code>Region Navigator</code>. While you browse around the genome, you can save some bookmarks by pressing the <code>Add</code> button at any time.</p>
<p><strong>Bookmarks in IGV</strong></p>
<div class="float">
<img src="assets/module_2/bookmarks.png" alt="Bookmarks in IGV" />
<div class="figcaption">Bookmarks in IGV</div>
</div>
</div>
<div id="loading-read-alignments" class="section level4 hasAnchor">
<h4>Loading Read Alignments<a href="module-2.html#loading-read-alignments" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We will be using the breast cancer cell line HCC1143 to visualize alignments. For speed, only a small portion of chr21 will be loaded (19M:20M).</p>
<p><strong>HCC1143 Alignments to hg19:</strong></p>
<ul>
<li><a href="assets/module_2/HCC1143.normal.21.19M-20M.bam">HCC1143.normal.21.19M-20M.bam</a></li>
<li><a href="assets/module_2/HCC1143.normal.21.19M-20M.bam.bai">HCC1143.normal.21.19M-20M.bam.bai</a></li>
</ul>
<p>Copy the files to your local drive, and in IGV choose <code>File &gt; Load from File...</code>, select the bam file, and click <code>OK</code>. Note that the bam and index files must be in the same directory for IGV to load these properly.</p>
<p><strong>Load BAM track from File</strong></p>
<div class="float">
<img src="assets/module_2/load_bam.png" alt="Load BAM track from File" />
<div class="figcaption">Load BAM track from File</div>
</div>
</div>
<div id="visualizing-read-alignments" class="section level4 hasAnchor">
<h4>Visualizing read alignments<a href="module-2.html#visualizing-read-alignments" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Navigate to a narrow window on chromosome 21: <code>chr21:19,480,041-19,480,386</code>.</p>
<p>To start our exploration, right click on the read alignment track, and select the following options:</p>
<ul>
<li><code>Sort alignments by</code> -&gt; <code>start location</code></li>
<li><code>Group alignments by</code> -&gt; <code>pair orientation</code></li>
</ul>
<p>Experiment with the various settings by right clicking the read alignment track and toggling the options. Think about which would be best for specific tasks (e.g. quality control, SNP calling, CNV finding).</p>
<p><strong>Changing how read alignments are sorted, grouped, and colored</strong></p>
<div class="float">
<img src="assets/module_2/sort_and_group.png" alt="Changing how read alignments are sorted, grouped, and colored" />
<div class="figcaption">Changing how read alignments are sorted, grouped, and colored</div>
</div>
<p>You will see reads represented by grey or white bars stacked on top of each other, where they were aligned to the reference genome. The reads are pointed to indicate their orientation (i.e. the strand on which they are mapped). Mouse over any read and notice that a lot of information is available. To toggle read display from hover to <code>click</code>, select the yellow box and change the setting.</p>
<p><strong>Changing how read information is shown (i.e. on hover, click, never)</strong></p>
<div class="float">
<img src="assets/module_2/show_details_on_click.png" alt="Changing how read information is shown (i.e. on hover, click, never)" />
<div class="figcaption">Changing how read information is shown (i.e. on hover, click, never)</div>
</div>
<p>Once you select a read, you will learn what many of these metrics mean, and how to use them to assess the quality of your datasets. At each base that the read sequence <strong>mismatches</strong> the reference, the colour of the base represents the letter that exists in the read (using the same colour legend used for displaying the reference).</p>
<p><strong>Viewing read information for a single aligned read</strong></p>
<div class="float">
<img src="assets/module_2/click_read.png" alt="Viewing read information for a single aligned read" />
<div class="figcaption">Viewing read information for a single aligned read</div>
</div>
<hr />
</div>
</div>
<div id="visualization-part-2-inspecting-snps-snvs-and-svs" class="section level3 hasAnchor">
<h3>Visualization Part 2: Inspecting SNPs, SNVs, and SVs<a href="module-2.html#visualization-part-2-inspecting-snps-snvs-and-svs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this section we will be looking in detail at 8 positions in the genome, and determining whether they represent real events or artifacts.</p>
<div id="two-neighbouring-snps" class="section level4 hasAnchor">
<h4>Two neighbouring SNPs<a href="module-2.html#two-neighbouring-snps" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Navigate to region <code>chr21:19,479,237-19,479,814</code></p></li>
<li><p>Note two heterozygous variants, one corresponds to a known dbSNP (<code>G/T</code> on the right) the other does not (<code>C/T</code> on the left)</p></li>
<li><p>Zoom in and center on the <code>C/T</code> SNV on the left, sort by base (window <code>chr21:19,479,321</code> is the SNV position)</p></li>
<li><p>Sort alignments by <code>base</code></p></li>
<li><p>Color alignments by <code>read strand</code></p></li>
</ul>
<p><strong>Example1. Good quality SNVs/SNPs</strong></p>
<div class="float">
<img src="assets/module_2/example1_color.png" alt="Example1. Good quality SNVs/SNPs" />
<div class="figcaption">Example1. Good quality SNVs/SNPs</div>
</div>
<p><strong>Notes:</strong></p>
<ul>
<li>High base qualities in all reads except one (where the alt allele is the last base of the read)</li>
<li>Good mapping quality of reads, no strand bias, allele frequency consistent with heterozygous mutation</li>
</ul>
<p><strong>Question(s):</strong></p>
<pre><code>* What does *Shade base by quality* do? How might this be helpful?
* How does Color by *read strand* help?</code></pre>
</div>
<div id="homopolymer-region-with-indel" class="section level4 hasAnchor">
<h4>Homopolymer region with indel<a href="module-2.html#homopolymer-region-with-indel" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Navigate to position <code>chr21:19,518,412-19,518,497</code></p>
<p><strong>Example 2a</strong></p>
<ul>
<li>Group alignments by <code>read strand</code></li>
<li>Center on the <code>A</code> within the homopolymer run (<code>chr21:19,518,470</code>), and <code>Sort alignments by</code> -&gt; <code>base</code></li>
</ul>
<div class="float">
<img src="assets/module_2/example2a.png" alt="Example 2a" />
<div class="figcaption">Example 2a</div>
</div>
<p><strong>Example 2b</strong></p>
<ul>
<li>Center on the one base deletion (<code>chr21:19,518,452</code>), and <code>Sort alignments by</code> -&gt; <code>base</code></li>
</ul>
<div class="float">
<img src="assets/module_2/example2b.png" alt="Example 2b" />
<div class="figcaption">Example 2b</div>
</div>
<p><strong>Notes:</strong></p>
<ul>
<li>The alt allele is either a deletion or insertion of one or two Ts</li>
<li>The remaining bases are mismatched, because the alignment is now out of sync</li>
</ul>
</div>
<div id="coverage-by-gc" class="section level4 hasAnchor">
<h4>Coverage by GC<a href="module-2.html#coverage-by-gc" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Navigate to position <code>chr21:19,611,925-19,631,555</code>. Note that the range contains areas where coverage drops to zero in a few places.</p>
<p><strong>Example 3</strong></p>
<ul>
<li>Use <code>Collapsed</code> view</li>
<li><code>Color alignments by</code> -&gt; <code>insert size and pair orientation</code></li>
<li><code>Group alignments by</code> -&gt; <code>none</code></li>
<li>Load GC track (if not already loaded above)</li>
<li>See concordance of coverage with GC content</li>
</ul>
<div class="float">
<img src="assets/module_2/example3.png" alt="Example 3" />
<div class="figcaption">Example 3</div>
</div>
<p><strong>Question:</strong></p>
<pre><code>* Why are there blue and red reads throughout the alignments?</code></pre>
</div>
<div id="heterozygous-snps-on-different-alleles" class="section level4 hasAnchor">
<h4>Heterozygous SNPs on different alleles<a href="module-2.html#heterozygous-snps-on-different-alleles" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Navigate to region <code>chr21:19,666,833-19,667,007</code></p>
<p><strong>Example 4</strong></p>
<ul>
<li>Sort by base (at position chr21:19,666,901)</li>
</ul>
<div class="float">
<img src="assets/module_2/example4.png" alt="Example 4" />
<div class="figcaption">Example 4</div>
</div>
<p><strong>Note:</strong></p>
<ul>
<li>There is no linkage between alleles for these two SNPs because reads covering both only contain one or the other</li>
</ul>
</div>
<div id="low-mapping-quality" class="section level4 hasAnchor">
<h4>Low mapping quality<a href="module-2.html#low-mapping-quality" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Navigate to region <code>chr21:19,800,320-19,818,162</code></p>
<ul>
<li>Load repeat track (<code>File</code> -&gt; <code>Load from server...</code>)</li>
</ul>
<p><strong>Load repeats</strong></p>
<div class="float">
<img src="assets/module_2/load_repeats.png" alt="Load repeats" />
<div class="figcaption">Load repeats</div>
</div>
<p><strong>Example 5</strong></p>
<div class="float">
<img src="assets/module_2/example5.png" alt="Example 5" />
<div class="figcaption">Example 5</div>
</div>
<p><strong>Notes:</strong></p>
<ul>
<li>Mapping quality plunges in all reads (white instead of grey). Once we load repeat elements, we see that there are two LINE elements that cause this.</li>
</ul>
</div>
<div id="homozygous-deletion" class="section level4 hasAnchor">
<h4>Homozygous deletion<a href="module-2.html#homozygous-deletion" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Navigate to region <code>chr21:19,324,469-19,331,468</code></p>
<p><strong>Example 6</strong></p>
<ul>
<li>Turn on <code>View as Pairs</code> and <code>Expanded</code> view</li>
<li>Use <code>Color alignments by</code> -&gt; <code>insert size and pair orientation</code></li>
<li>Sort reads by insert size</li>
<li>Click on a red read pair to pull up information on alignments</li>
</ul>
<div class="float">
<img src="assets/module_2/example6.png" alt="Example 6" />
<div class="figcaption">Example 6</div>
</div>
<p><strong>Notes:</strong></p>
<ul>
<li>Typical insert size of read pair in the vicinity: 350bp</li>
<li>Insert size of red read pairs: 2,875bp</li>
<li>This corresponds to a homozygous deletion of 2.5kb</li>
</ul>
</div>
<div id="mis-alignment" class="section level4 hasAnchor">
<h4>Mis-alignment<a href="module-2.html#mis-alignment" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Navigate to region <code>chr21:19,102,154-19,103,108</code></p>
<p><strong>Example 7</strong></p>
<div class="float">
<img src="assets/module_2/example7.png" alt="Example 7" />
<div class="figcaption">Example 7</div>
</div>
<p><strong>Notes:</strong></p>
<ul>
<li>This is a position where AluY element causes mis-alignment.</li>
<li>Misaligned reads have mismatches to the reference and well-aligned reads have partners on other chromosomes where additional ALuY elements are encoded.</li>
<li>Zoom out until you can clearly see the contrast between the difficult alignment region (corresponding to an AluY) and regions with clean alignments on either side</li>
</ul>
</div>
<div id="translocation" class="section level4 hasAnchor">
<h4>Translocation<a href="module-2.html#translocation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Navigate to region <code>chr21:19,089,694-19,095,362</code></p>
<p><strong>Example 8</strong></p>
<ul>
<li>Expanded view</li>
<li><code>Group alignments by</code> -&gt; <code>pair orientation</code></li>
<li><code>Color alignments by</code> -&gt; <code>insert size and pair orientation</code></li>
</ul>
<div class="float">
<img src="assets/module_2/example8.png" alt="Example 8" />
<div class="figcaption">Example 8</div>
</div>
<p><strong>Notes:</strong></p>
<ul>
<li>Many reads with mismatches to reference</li>
<li>Read pairs in RL pattern (instead of LR pattern)</li>
<li>Region is flanked by reads with poor mapping quality (white instead of grey)</li>
<li>Presence of reads with pairs on other chromosomes (coloured reads at the bottom when scrolling down)</li>
</ul>
<hr />
</div>
</div>
<div id="visualization-part-3-automating-tasks-in-igv" class="section level3 hasAnchor">
<h3>Visualization Part 3: Automating Tasks in IGV<a href="module-2.html#visualization-part-3-automating-tasks-in-igv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can use the Tools menu to invoke running a batch script. Batch scripts are described on the IGV website:</p>
<ul>
<li>Batch file requirements: <a href="https://software.broadinstitute.org/software/igv/batch">https://www.broadinstitute.org/igv/batch</a></li>
<li>Commands recognized in a batch script: <a href="https://software.broadinstitute.org/software/igv/PortCommands">https://software.broadinstitute.org/software/igv/PortCommands</a></li>
<li>We also need to provide sample attribute file as described here: <a href="https://software.broadinstitute.org/software/igv/SampleInformation">https://software.broadinstitute.org/software/igv/SampleInformation</a></li>
</ul>
<p>Download the batch script and the attribute file for our dataset:</p>
<ul>
<li>Batch script: <a href="https://github.com/griffithlab/rnabio.org/raw/master/assets/scripts/Run_batch_IGV_snapshots.txt">Run_batch_IGV_snapshots.txt</a></li>
<li>Attribute file: <a href="https://github.com/griffithlab/rnabio.org/raw/master/assets/scripts/Igv_HCC1143_attributes.txt">Igv_HCC1143_attributes.txt</a></li>
</ul>
<p>Hint: You can use the <code>curl -L -O</code> with the above URLs to download the files using the terminal!</p>
<p>Now run the file from the <code>Tools</code> menu:</p>
<p><strong>Automation</strong></p>
<div class="float">
<img src="assets/module_2/run_batch_script.png" alt="Automation" />
<div class="figcaption">Automation</div>
</div>
<p><strong>Notes:</strong></p>
<ul>
<li>This script will navigate automatically to each location in the lab</li>
<li>A screenshot will be taken and saved to the screenshots directory specified</li>
</ul>
<div id="contributorsacknowledgements" class="section level4 hasAnchor">
<h4>Contributors/acknowledgements<a href="module-2.html#contributorsacknowledgements" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Malachi Griffith, Sorana Morrissy, Jim Robinson, Ben Ainscough, Jason Walker, Obi Griffith, Kartik Singhal</p>
<hr />
<div class="float">
<img src="assets/module_2/RNA-seq_Flowchart3.png" alt="RNA-seq_Flowchart3" />
<div class="figcaption">RNA-seq_Flowchart3</div>
</div>
<hr />
<p>Before we can view our alignments in the IGV browser we need to index our BAM files. We will use samtools index for this purpose. For convenience later, index all bam files.</p>
</div>
</div>
<div id="indexing-bam-files-with-samtools" class="section level3 hasAnchor">
<h3>Indexing BAM files with samtools<a href="module-2.html#indexing-bam-files-with-samtools" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb84-1"><a href="module-2.html#cb84-1" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb84-2"><a href="module-2.html#cb84-2" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb84-3"><a href="module-2.html#cb84-3" tabindex="-1"></a></span>
<span id="cb84-4"><a href="module-2.html#cb84-4" tabindex="-1"></a><span class="ex">samtools</span> index <span class="at">-M</span> <span class="pp">*</span>.bam</span>
<span id="cb84-5"><a href="module-2.html#cb84-5" tabindex="-1"></a></span>
<span id="cb84-6"><a href="module-2.html#cb84-6" tabindex="-1"></a><span class="co"># flag -M interprets all filename arguments as files to be indexed, allowing multiple files to be indexed at the same time. To index individual file, use &#39;samtools index input.bam&#39; </span></span>
<span id="cb84-7"><a href="module-2.html#cb84-7" tabindex="-1"></a><span class="co"># Note that we could have created and run a samtools index command for all files ending in .bam using the following construct:</span></span>
<span id="cb84-8"><a href="module-2.html#cb84-8" tabindex="-1"></a><span class="co"># find *.bam -exec echo samtools index {} \; | sh</span></span></code></pre></div>
<p>Optional:</p>
<p>Try to create an index file for one of your bam files using a samtools docker image rather than the locally installed version of samtools. Below is an example docker run command.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb85-1"><a href="module-2.html#cb85-1" tabindex="-1"></a><span class="fu">cp</span> HBR.bam /tmp/</span>
<span id="cb85-2"><a href="module-2.html#cb85-2" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-v</span> /tmp:/docker_workspace biocontainers/samtools:v1.9-4-deb_cv1 samtools index /docker_workspace/HBR.bam</span>
<span id="cb85-3"><a href="module-2.html#cb85-3" tabindex="-1"></a><span class="fu">ls</span> /tmp/HBR.bam<span class="pp">*</span></span></code></pre></div>
<p><code>docker run</code> is how you initialize a docker container to run a command</p>
<p><code>-v</code> is the parameter used to mount your workspace so that the docker container can see the files that you’re working with. In the example above, <code>/tmp</code> from the EC2 instance has been mounted as <code>/docker_workspace</code> within the docker container.</p>
<p><code>biocontainers/samtools</code> is the docker container name. The <code>:v1.9-4-deb_cv1</code> refers to the specific tag and release of the docker container.</p>
<p>In the next step we will visualize these alignment BAM files using IGV.</p>
<p>Now that our BAM files have been indexed with samtools we can load them and explore the RNA-seq alignments using the Integrative Genomics Viewer (<a href="https://igv.org/">IGV</a>).</p>
<p>The exercise below assumes that you have IGV installed on your local computer. If you are unable to get IGV to run locally you may also consider a web based version of IGV that runs in your browser. The interface of the IGV Web App is different from the local install, and is missing a few features, but is conceptually very similar. To access it simply visit: <a href="https://igv.org/app/">IGV Web App</a>.</p>
</div>
<div id="visualize-alignments-with-igv" class="section level3 hasAnchor">
<h3>Visualize alignments with IGV<a href="module-2.html#visualize-alignments-with-igv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Start IGV on your computer/laptop. Load the UHR.bam &amp; HBR.bam files in IGV. If you’re using AWS, you can load the necessary files in IGV directly from your web accessible amazon workspace (see below) using ‘File’ -&gt; ‘Load from URL’.</p>
<p>Make sure you select the appropriate reference genome build in IGV (top left corner of IGV): in this case <code>hg38</code>.</p>
<div id="aws-links-to-bam-files" class="section level4 hasAnchor">
<h4>AWS links to bam files<a href="module-2.html#aws-links-to-bam-files" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>UHR hisat2 alignment</strong>: <a href="http://" class="uri">http://</a><strong>YOUR_PUBLIC_IPv4_ADDRESS</strong>/rnaseq/alignments/hisat2/UHR.bam</li>
<li><strong>HBR hisat2 alignment</strong>: <a href="http://" class="uri">http://</a><strong>YOUR_PUBLIC_IPv4_ADDRESS</strong>/rnaseq/alignments/hisat2/HBR.bam</li>
</ul>
</div>
<div id="links-to-cached-version-of-these-bam-files" class="section level4 hasAnchor">
<h4>Links to cached version of these bam files<a href="module-2.html#links-to-cached-version-of-these-bam-files" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If for some reason you do not have access to the BAM files from running through this course you can download and use these cached versions instead:</p>
<ul>
<li><strong>UHR hisat2 alignment</strong>: <a href="https://genomedata.org/rnaseq-tutorial/results/alignments/hisat/UHR.bam">UHR.bam</a> (<a href="https://genomedata.org/rnaseq-tutorial/results/alignments/hisat/UHR.bam.bai">UHR.bam.bai</a>)</li>
<li><strong>HBR hisat2 alignment</strong>: <a href="https://genomedata.org/rnaseq-tutorial/results/alignments/hisat/HBR.bam">HBR.bam</a> (<a href="https://genomedata.org/rnaseq-tutorial/results/alignments/hisat/HBR.bam.bai">HBR.bam.bai</a>)</li>
</ul>
<p>You may wish to customize the track names as you load them in to keep them straight. Do this by right-clicking on the alignment track and choosing ‘Rename Track’.</p>
<p>Go to an example gene locus on chr22:</p>
<ul>
<li>e.g. EIF3L, NDUFA6, and RBX1 have nice coverage</li>
<li>e.g. SULT4A1 and GTSE1 are differentially expressed. Are they up-regulated or down-regulated in the brain (HBR) compared to cancer cell lines (UHR)?</li>
<li>Mouse over some reads and use the read group (RG) flag to determine which replicate the reads come from. What other details can you learn about each read and its alignment to the reference genome.</li>
</ul>
</div>
<div id="exercise" class="section level4 hasAnchor">
<h4>Exercise<a href="module-2.html#exercise" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Try to find a variant position in the RNAseq data:</p>
<ul>
<li>HINT: DDX17 is a highly expressed gene with several variants in its 3 prime UTR.</li>
<li>Other highly expressed genes you might explore are: NUP50, CYB5R3, and EIF3L (all have at least one transcribed variant).</li>
<li>Are these variants previously known (e.g., present in dbSNP)?</li>
<li>How should we interpret the allele frequency of each variant? Remember that we have rather unusual samples here in that they are actually pooled RNAs corresponding to multiple individuals (genotypes).</li>
<li>Take note of the genomic position of your variant. We will need this later.</li>
</ul>
<div id="igv-visualization-example-ddx17-3-prime-region" class="section level5 hasAnchor">
<h5>IGV visualization example (DDX17 3 prime region)<a href="module-2.html#igv-visualization-example-ddx17-3-prime-region" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="float">
<img src="assets/module_2/igv-ddx17.png" alt="IGV-DDX17" />
<div class="figcaption">IGV-DDX17</div>
</div>
<hr />
</div>
</div>
</div>
<div id="practical-exercise-7" class="section level3 hasAnchor">
<h3>PRACTICAL EXERCISE 7<a href="module-2.html#practical-exercise-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Assignment: Index your bam files from Practical Exercise 6 and visualize in IGV.</p>
<ul>
<li>Hint: As before, it may be simplest to just index and visualize the combined/merged bam files HCC1395_normal.bam and HCC1395_tumor.bam.</li>
<li>If this works, you should have two BAM files that can be loaded into IGV from the following location on your cloud instance:
<ul>
<li><a href="http://" class="uri">http://</a><strong>YOUR_PUBLIC_IPv4_ADDRESS</strong>/rnaseq/practice/alignments/hisat2/</li>
</ul></li>
</ul>
<div id="links-to-cached-version-of-the-practical-exercise-bam-files" class="section level4 hasAnchor">
<h4>Links to cached version of the practical exercise bam files<a href="module-2.html#links-to-cached-version-of-the-practical-exercise-bam-files" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If for some reason you do not have access to the BAM files from running through this course you can download and use these cached versions instead:</p>
<ul>
<li><strong>HCC1395-normal hisat2 alignment</strong>: <a href="https://genomedata.org/rnaseq-tutorial/results/alignments/hisat/HCC1395_normal.bam">HCC1395-normal.bam</a> (<a href="https://genomedata.org/rnaseq-tutorial/results/alignments/hisat/HCC1395_normal.bam.bai">HCC1395-normal.bam.bai</a>)</li>
<li><strong>HCC1395-tumor hisat2 alignment</strong>: <a href="https://genomedata.org/rnaseq-tutorial/results/alignments/hisat/HCC1395_tumor.bam">HCC1395-tumor.bam</a> (<a href="https://genomedata.org/rnaseq-tutorial/results/alignments/hisat/HCC1395_tumor.bam.bai">HCC1395-tumor.bam.bai</a>)</li>
</ul>
<p><strong>Questions</strong></p>
<ul>
<li>Load your merged normal and tumor BAM files into IGV. Navigate to this location on chromosome 22: ‘chr22:38,466,394-38,508,115’. What do you see here? How would you describe the direction of transcription for the two genes? Does the reported strand for the reads aligned to each of these genes appear to make sense? How do you modify IGV settings to see the strand clearly?</li>
<li>How can we modify IGV to color reads by Read Group? How many read groups are there for each sample (tumor &amp; normal)? What are your read group names for the tumor sample?</li>
<li>What are the options for visualizing splicing or alternative splicing patterns in IGV? Navigate to this location on chromosome 22: ‘chr22:40,363,200-40,367,500’. What splicing event do you see?</li>
</ul>
<p>Solution: When you are ready you can check your approach against the <a href="/module-09-appendix/0009/05/01/Practical_Exercise_Solutions/#practical-exercise-7---visualize">Solutions</a>.</p>
<p>In this section we will demonstrate how to assess expression of specific variant alleles in the RNA-seq BAM using tools designed to interrogate read alignments and sequence base identities at particular positions.</p>
</div>
</div>
<div id="bam-read-counting" class="section level3 hasAnchor">
<h3>BAM Read Counting<a href="module-2.html#bam-read-counting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using one of the variant positions identified above, count the number of supporting reference and variant reads. First, use <code>samtools mpileup</code> to visualize a region of alignment with a variant.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb86-1"><a href="module-2.html#cb86-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_HOME</span></span>
<span id="cb86-2"><a href="module-2.html#cb86-2" tabindex="-1"></a><span class="fu">mkdir</span> bam_readcount</span>
<span id="cb86-3"><a href="module-2.html#cb86-3" tabindex="-1"></a><span class="bu">cd</span> bam_readcount</span></code></pre></div>
<p>Create faidx indexed reference sequence file for use with mpileup</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb87-1"><a href="module-2.html#cb87-1" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$RNA_REF_FASTA</span></span>
<span id="cb87-2"><a href="module-2.html#cb87-2" tabindex="-1"></a><span class="ex">samtools</span> faidx <span class="va">$RNA_REF_FASTA</span></span></code></pre></div>
<p>Run <code>samtools mpileup</code> on a region of interest</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb88-1"><a href="module-2.html#cb88-1" tabindex="-1"></a><span class="ex">samtools</span> mpileup <span class="at">-f</span> <span class="va">$RNA_REF_FASTA</span> <span class="at">-r</span> 22:18918457-18918467 <span class="va">$RNA_ALIGN_DIR</span>/UHR.bam <span class="va">$RNA_ALIGN_DIR</span>/HBR.bam</span></code></pre></div>
<p>Each line consists of chromosome, 1-based coordinate, reference base, the number of reads covering the site, read bases and base qualities. At the read base column, a dot stands for a match to the reference base on the forward strand, a comma for a match on the reverse strand, <code>ACGTN</code> for a mismatch on the forward strand and <code>acgtn</code> for a mismatch on the reverse strand. A pattern <code>\+[0-9]+[ACGTNacgtn]+</code> indicates there is an insertion between this reference position and the next reference position. The length of the insertion is given by the integer in the pattern, followed by the inserted sequence. See samtools pileup/mpileup documentation for more explanation of the output:</p>
<ul>
<li><a href="http://samtools.sourceforge.net/pileup.shtml">http://samtools.sourceforge.net/pileup.shtml</a></li>
<li><a href="http://samtools.sourceforge.net/mpileup.shtml">http://samtools.sourceforge.net/mpileup.shtml</a></li>
</ul>
<p>Now, use <code>bam-readcount</code> to count reference and variant bases at a specific position. First, create a bed file with some positions of interest (we will create a file called snvs.bed using the echo command).</p>
<p>It will contain a single line specifying a variant position on chr22 e.g.:</p>
<p>22:38483683-38483683</p>
<p>Create the bed file</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb89-1"><a href="module-2.html#cb89-1" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;22 38483683 38483683&quot;</span></span>
<span id="cb89-2"><a href="module-2.html#cb89-2" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;22 38483683 38483683&quot;</span> <span class="op">&gt;</span> snvs.bed</span></code></pre></div>
<p>Run <code>bam-readcount</code> on this list for the tumor and normal merged bam files</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb90-1"><a href="module-2.html#cb90-1" tabindex="-1"></a><span class="ex">bam-readcount</span> <span class="at">-l</span> snvs.bed <span class="at">-f</span> <span class="va">$RNA_REF_FASTA</span> <span class="va">$RNA_ALIGN_DIR</span>/UHR.bam <span class="dv">2</span><span class="op">&gt;</span>/dev/null</span>
<span id="cb90-2"><a href="module-2.html#cb90-2" tabindex="-1"></a><span class="ex">bam-readcount</span> <span class="at">-l</span> snvs.bed <span class="at">-f</span> <span class="va">$RNA_REF_FASTA</span> <span class="va">$RNA_ALIGN_DIR</span>/HBR.bam <span class="dv">2</span><span class="op">&gt;</span>/dev/null</span></code></pre></div>
<p>Now, run it again, but ignore stderr and redirect stdout to a file:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb91-1"><a href="module-2.html#cb91-1" tabindex="-1"></a><span class="ex">bam-readcount</span> <span class="at">-l</span> snvs.bed <span class="at">-f</span> <span class="va">$RNA_REF_FASTA</span> <span class="va">$RNA_ALIGN_DIR</span>/UHR.bam <span class="dv">2</span><span class="op">&gt;</span>/dev/null <span class="dv">1</span><span class="op">&gt;</span>UHR_bam-readcounts.txt</span>
<span id="cb91-2"><a href="module-2.html#cb91-2" tabindex="-1"></a><span class="ex">bam-readcount</span> <span class="at">-l</span> snvs.bed <span class="at">-f</span> <span class="va">$RNA_REF_FASTA</span> <span class="va">$RNA_ALIGN_DIR</span>/HBR.bam <span class="dv">2</span><span class="op">&gt;</span>/dev/null <span class="dv">1</span><span class="op">&gt;</span>HBR_bam-readcounts.txt</span></code></pre></div>
<p>From this output you could parse the read counts for each base</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb92-1"><a href="module-2.html#cb92-1" tabindex="-1"></a><span class="fu">cat</span> UHR_bam-readcounts.txt <span class="kw">|</span> <span class="fu">perl</span> <span class="at">-ne</span> <span class="st">&#39;@data=split(&quot;\t&quot;, $_); @Adata=split(&quot;:&quot;, $data[5]); @Cdata=split(&quot;:&quot;, $data[6]); @Gdata=split(&quot;:&quot;, $data[7]); @Tdata=split(&quot;:&quot;, $data[8]); print &quot;UHR Counts\t$data[0]\t$data[1]\tA: $Adata[1]\tC: $Cdata[1]\tT: $Tdata[1]\tG: $Gdata[1]\n&quot;;&#39;</span></span>
<span id="cb92-2"><a href="module-2.html#cb92-2" tabindex="-1"></a><span class="fu">cat</span> HBR_bam-readcounts.txt <span class="kw">|</span> <span class="fu">perl</span> <span class="at">-ne</span> <span class="st">&#39;@data=split(&quot;\t&quot;, $_); @Adata=split(&quot;:&quot;, $data[5]); @Cdata=split(&quot;:&quot;, $data[6]); @Gdata=split(&quot;:&quot;, $data[7]); @Tdata=split(&quot;:&quot;, $data[8]); print &quot;HBR Counts\t$data[0]\t$data[1]\tA: $Adata[1]\tC: $Cdata[1]\tT: $Tdata[1]\tG: $Gdata[1]\n&quot;;&#39;</span></span></code></pre></div>
<p>If reading perl code isn’t your favorite thing to do, here’s a <a href="https://github.com/genome/bam-readcount/tree/master/tutorial">bam-readcount tutorial</a> that uses python to parse output from bam-readcount to identify a Omicron SARS-CoV-2 variant of concern from raw sequence data.</p>
<hr />
</div>
<div id="practical-exercise-7-1" class="section level3 hasAnchor">
<h3>PRACTICAL EXERCISE 7<a href="module-2.html#practical-exercise-7-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Assignment: Index your bam files from Practical Exercise 6 and visualize in IGV.</p>
<ul>
<li>Hint: As before, it may be simplest to just index and visualize the combined/merged bam files HCC1395_normal.bam and HCC1395_tumor.bam.</li>
<li>If this works, you should have two BAM files that can be loaded into IGV from the following location on your cloud instance:
<ul>
<li><a href="http://" class="uri">http://</a><strong>YOUR_PUBLIC_IPv4_ADDRESS</strong>/rnaseq/practice/alignments/hisat2/</li>
</ul></li>
</ul>
<p><strong>Questions</strong></p>
<ul>
<li>Load your merged normal and tumor BAM files into IGV. Navigate to this location on chromosome 22: ‘chr22:38,466,394-38,508,115’. What do you see here? How would you describe the direction of transcription for the two genes? Does the reported strand for the reads aligned to each of these genes appear to make sense? How do you modify IGV settings to see the strand clearly?</li>
<li>How can we modify IGV to color reads by Read Group? How many read groups are there for each sample (tumor &amp; normal)? What are your read group names for the tumor sample?</li>
<li>What are the options for visualizing splicing or alternative splicing patterns in IGV? Navigate to this location on chromosome 22: ‘chr22:40,363,200-40,367,500’. What splicing event do you see?</li>
</ul>
<p>Solution: When you are ready you can check your approach against the <a href="/module-09-appendix/0009/05/01/Practical_Exercise_Solutions/#practical-exercise-7---visualize">Solutions</a>.</p>
</div>
<div id="alignment-qc-mini-lecture" class="section level3 hasAnchor">
<h3>Alignment QC mini lecture<a href="module-2.html#alignment-qc-mini-lecture" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you would like a refresher on alignment QC, we have made a <a href="https://github.com/griffithlab/rnabio.org/blob/master/assets/lectures/cbw/2025/mini/RNASeq_MiniLecture_02_04_alignmentQC.pdf">mini lecture</a> briefly covering the topic.</p>
</div>
<div id="use-samtools-and-fastqc-to-evaluate-the-alignments" class="section level3 hasAnchor">
<h3>Use samtools and FastQC to evaluate the alignments<a href="module-2.html#use-samtools-and-fastqc-to-evaluate-the-alignments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use <code>samtools view</code> to see the format of a SAM/BAM alignment file</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb93-1"><a href="module-2.html#cb93-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb93-2"><a href="module-2.html#cb93-2" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-H</span> UHR.bam</span>
<span id="cb93-3"><a href="module-2.html#cb93-3" tabindex="-1"></a><span class="ex">samtools</span> view UHR.bam <span class="kw">|</span> <span class="fu">head</span></span>
<span id="cb93-4"><a href="module-2.html#cb93-4" tabindex="-1"></a><span class="ex">samtools</span> view UHR.bam <span class="kw">|</span> <span class="fu">head</span> <span class="kw">|</span> <span class="ex">column</span> <span class="at">-t</span> <span class="kw">|</span> <span class="fu">less</span> <span class="at">-S</span></span></code></pre></div>
<p>Try filtering the BAM file to require or exclude certain flags. This can be done with <code>samtools view -f -F</code> options</p>
<p>-f INT required flag -F INT filtering flag</p>
<p>“Samtools flags explained”</p>
<ul>
<li><a href="http://broadinstitute.github.io/picard/explain-flags.html">http://broadinstitute.github.io/picard/explain-flags.html</a></li>
</ul>
<p>Try requiring that alignments are ‘paired’ and ‘mapped in a proper pair’ (=3).</p>
<p>Also filter out alignments that are ‘unmapped’, the ‘mate is unmapped’, and ‘not primary alignment’ (=268)</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb94-1"><a href="module-2.html#cb94-1" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-f</span> 3 <span class="at">-F</span> 268 UHR.bam <span class="kw">|</span> <span class="fu">head</span> <span class="kw">|</span> <span class="ex">column</span> <span class="at">-t</span> <span class="kw">|</span> <span class="fu">less</span> <span class="at">-S</span></span></code></pre></div>
<p>Now require that the alignments be only for ‘PCR or optical duplicate’. How many reads meet this criteria? Why?</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb95-1"><a href="module-2.html#cb95-1" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-f</span> 1024 UHR.bam <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div>
<p>Use <code>samtools flagstat</code> to get a basic summary of an alignment. What percent of reads are mapped? Is this realistic? Why?</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb96-1"><a href="module-2.html#cb96-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb96-2"><a href="module-2.html#cb96-2" tabindex="-1"></a><span class="fu">mkdir</span> flagstat</span>
<span id="cb96-3"><a href="module-2.html#cb96-3" tabindex="-1"></a></span>
<span id="cb96-4"><a href="module-2.html#cb96-4" tabindex="-1"></a><span class="ex">samtools</span> flagstat HBR_Rep1.bam <span class="op">&gt;</span> flagstat/HBR_Rep1.bam.flagstat</span>
<span id="cb96-5"><a href="module-2.html#cb96-5" tabindex="-1"></a><span class="ex">samtools</span> flagstat HBR_Rep2.bam <span class="op">&gt;</span> flagstat/HBR_Rep2.bam.flagstat</span>
<span id="cb96-6"><a href="module-2.html#cb96-6" tabindex="-1"></a><span class="ex">samtools</span> flagstat HBR_Rep3.bam <span class="op">&gt;</span> flagstat/HBR_Rep3.bam.flagstat</span>
<span id="cb96-7"><a href="module-2.html#cb96-7" tabindex="-1"></a><span class="ex">samtools</span> flagstat UHR_Rep1.bam <span class="op">&gt;</span> flagstat/UHR_Rep1.bam.flagstat</span>
<span id="cb96-8"><a href="module-2.html#cb96-8" tabindex="-1"></a><span class="ex">samtools</span> flagstat UHR_Rep2.bam <span class="op">&gt;</span> flagstat/UHR_Rep2.bam.flagstat</span>
<span id="cb96-9"><a href="module-2.html#cb96-9" tabindex="-1"></a><span class="ex">samtools</span> flagstat UHR_Rep3.bam <span class="op">&gt;</span> flagstat/UHR_Rep3.bam.flagstat</span>
<span id="cb96-10"><a href="module-2.html#cb96-10" tabindex="-1"></a></span>
<span id="cb96-11"><a href="module-2.html#cb96-11" tabindex="-1"></a><span class="co"># Note that we could have created and run a samtools flagstat command for all files ending in *Rep*.bam using the following construct:</span></span>
<span id="cb96-12"><a href="module-2.html#cb96-12" tabindex="-1"></a><span class="co"># find *Rep*.bam -exec echo samtools flagstat {} \&gt; flagstat/{}.flagstat \; | sh</span></span>
<span id="cb96-13"><a href="module-2.html#cb96-13" tabindex="-1"></a></span>
<span id="cb96-14"><a href="module-2.html#cb96-14" tabindex="-1"></a><span class="co"># View an example</span></span>
<span id="cb96-15"><a href="module-2.html#cb96-15" tabindex="-1"></a><span class="fu">cat</span> flagstat/UHR_Rep1.bam.flagstat</span></code></pre></div>
<p>Details of the SAM/BAM format can be found here: <a href="http://samtools.sourceforge.net/SAM1.pdf">http://samtools.sourceforge.net/SAM1.pdf</a></p>
</div>
<div id="create-versions-of-our-bam-files-with-only-the-chromosome-22-alignments" class="section level3 hasAnchor">
<h3>Create versions of our BAM files with only the chromosome 22 alignments<a href="module-2.html#create-versions-of-our-bam-files-with-only-the-chromosome-22-alignments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Note that our alignments contain those for the spiked in ERCC control sequences. For some QC analyses, these sequences complicate interpretation because they are not like human genes (e.g. no introns or UTRs). To allow us flexibility for the QC analysis we will create a version of each BAM file that only has the chromosome 22 alignments.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb97-1"><a href="module-2.html#cb97-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb97-2"><a href="module-2.html#cb97-2" tabindex="-1"></a><span class="fu">mkdir</span> chr22_only_bams</span>
<span id="cb97-3"><a href="module-2.html#cb97-3" tabindex="-1"></a><span class="fu">find</span> <span class="pp">*</span>Rep<span class="pp">*</span>.bam <span class="at">-exec</span> echo samtools view <span class="at">-b</span> {} 22 <span class="at">-o</span> chr22_only_bams/{} <span class="dt">\;</span> <span class="kw">|</span> <span class="fu">sh</span></span>
<span id="cb97-4"><a href="module-2.html#cb97-4" tabindex="-1"></a><span class="ex">samtools</span> index <span class="at">-M</span> chr22_only_bams/<span class="pp">*</span>.bam</span></code></pre></div>
</div>
<div id="using-fastqc" class="section level3 hasAnchor">
<h3>Using FastQC<a href="module-2.html#using-fastqc" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can use FastQC to perform basic QC of your BAM file (See <a href="https://rnabio.org/module-01-inputs/0001/06/01/Pre-alignment_QC/">Pre-alignment QC</a>). This will give you output very similar to when you ran FastQC on your fastq files.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb98-1"><a href="module-2.html#cb98-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb98-2"><a href="module-2.html#cb98-2" tabindex="-1"></a><span class="ex">fastqc</span> UHR_Rep1.bam UHR_Rep2.bam UHR_Rep3.bam HBR_Rep1.bam HBR_Rep2.bam HBR_Rep3.bam</span>
<span id="cb98-3"><a href="module-2.html#cb98-3" tabindex="-1"></a><span class="fu">mkdir</span> fastqc</span>
<span id="cb98-4"><a href="module-2.html#cb98-4" tabindex="-1"></a><span class="fu">mv</span> <span class="pp">*</span>fastqc.html fastqc/</span>
<span id="cb98-5"><a href="module-2.html#cb98-5" tabindex="-1"></a><span class="fu">mv</span> <span class="pp">*</span>fastqc.zip fastqc/</span></code></pre></div>
</div>
<div id="using-picard" class="section level3 hasAnchor">
<h3>Using Picard<a href="module-2.html#using-picard" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can use Picard to generate RNA-seq specific quality metrics and figures</p>
<p>In this section we need to create some additional formats of our reference transcriptome files.</p>
<p>Picard uses a “sequence dictionary” file for many commands (simply a list of reference sequences and their sizes)</p>
<p>We will also filter our transcriptome GTF to one with only ribosomal features, convert it to BED format and then to IntervalList format.
This is all done to get the IntervalList format needed for Picard CollectRnaSeqMetrics</p>
<p>We will also create a version of our whole transcriptome GTF in the <a href="http://genome.ucsc.edu/goldenPath/gbdDescriptionsOld.html#RefFlat">RefFlat</a> format needed for Picard CollectRnaSeqMetrics. To get to the RefFlat format we will convert GTF to <a href="https://genome.ucsc.edu/goldenPath/gbdDescriptionsOld.html#GenePredExt">GenePredExt</a> format and then simplify this to RefFlat.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb99-1"><a href="module-2.html#cb99-1" tabindex="-1"></a><span class="co"># Generating the necessary input files for picard CollectRnaSeqMetrics</span></span>
<span id="cb99-2"><a href="module-2.html#cb99-2" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_HOME</span>/refs</span>
<span id="cb99-3"><a href="module-2.html#cb99-3" tabindex="-1"></a></span>
<span id="cb99-4"><a href="module-2.html#cb99-4" tabindex="-1"></a><span class="co"># Create a .dict file for our reference</span></span>
<span id="cb99-5"><a href="module-2.html#cb99-5" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> <span class="va">$PICARD</span> CreateSequenceDictionary <span class="at">-R</span> chr22_with_ERCC92.fa <span class="at">-O</span> chr22_with_ERCC92.dict</span>
<span id="cb99-6"><a href="module-2.html#cb99-6" tabindex="-1"></a></span>
<span id="cb99-7"><a href="module-2.html#cb99-7" tabindex="-1"></a><span class="co"># Create a bed file of the location of ribosomal sequences in our reference (first extract them from the GTF then convert to BED format)</span></span>
<span id="cb99-8"><a href="module-2.html#cb99-8" tabindex="-1"></a><span class="co"># Note that here we pull all the &quot;rrna&quot; transcripts from the GTF. This is a good strategy for the whole transcriptome ...</span></span>
<span id="cb99-9"><a href="module-2.html#cb99-9" tabindex="-1"></a><span class="co"># ... but on chr22 there is very little &quot;rrna&quot; content, leading to 0 coverage for all samples, so we are also adding a single protein coding ribosomal gene &quot;RRP7A&quot; (normally we would not do this)</span></span>
<span id="cb99-10"><a href="module-2.html#cb99-10" tabindex="-1"></a></span>
<span id="cb99-11"><a href="module-2.html#cb99-11" tabindex="-1"></a><span class="co"># Note the convert2bed command will convert our GTF to BED format</span></span>
<span id="cb99-12"><a href="module-2.html#cb99-12" tabindex="-1"></a><span class="co"># &quot;&lt;&quot; is used to feed the GTF file into the tool.  &quot;&gt;2/dev/null&quot; is used to throw away a harmless warning. &quot;1&gt;&quot; is use to save our result to a file</span></span>
<span id="cb99-13"><a href="module-2.html#cb99-13" tabindex="-1"></a></span>
<span id="cb99-14"><a href="module-2.html#cb99-14" tabindex="-1"></a><span class="fu">grep</span> <span class="at">--color</span><span class="op">=</span>none <span class="at">-i</span> <span class="at">-P</span> <span class="st">&quot;rrna|rrp7a&quot;</span> chr22_with_ERCC92.gtf <span class="op">&gt;</span> ref_ribosome.gtf</span>
<span id="cb99-15"><a href="module-2.html#cb99-15" tabindex="-1"></a><span class="ex">convert2bed</span> <span class="at">--input</span><span class="op">=</span>gtf <span class="at">--output</span><span class="op">=</span>bed <span class="op">&lt;</span> ref_ribosome.gtf <span class="dv">2</span><span class="op">&gt;</span>/dev/null <span class="dv">1</span><span class="op">&gt;</span>ref_ribosome.bed</span>
<span id="cb99-16"><a href="module-2.html#cb99-16" tabindex="-1"></a></span>
<span id="cb99-17"><a href="module-2.html#cb99-17" tabindex="-1"></a><span class="co"># Create interval list file for the location of just the ribosomal sequences in our reference</span></span>
<span id="cb99-18"><a href="module-2.html#cb99-18" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> <span class="va">$PICARD</span> BedToIntervalList <span class="at">-I</span> ref_ribosome.bed <span class="at">-O</span> ref_ribosome.interval_list <span class="at">-SD</span> chr22_with_ERCC92.dict</span>
<span id="cb99-19"><a href="module-2.html#cb99-19" tabindex="-1"></a></span>
<span id="cb99-20"><a href="module-2.html#cb99-20" tabindex="-1"></a><span class="co"># Create a genePred file for our whole reference transcriptome</span></span>
<span id="cb99-21"><a href="module-2.html#cb99-21" tabindex="-1"></a><span class="ex">gtfToGenePred</span> <span class="at">-genePredExt</span> chr22_with_ERCC92.gtf chr22_with_ERCC92.genePredExt</span>
<span id="cb99-22"><a href="module-2.html#cb99-22" tabindex="-1"></a></span>
<span id="cb99-23"><a href="module-2.html#cb99-23" tabindex="-1"></a><span class="co"># Reformat this genePred file to first add the Ensembl gene ID column to the beginning of the dataframe using &quot;awk&quot;, and then subset it down to the first 11 columns using &quot;cut&quot;.</span></span>
<span id="cb99-24"><a href="module-2.html#cb99-24" tabindex="-1"></a><span class="fu">cat</span> chr22_with_ERCC92.genePredExt <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $12&quot;\t&quot;$0}&#39;</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-d</span><span class="st">$&#39;</span><span class="dt">\t</span><span class="st">&#39;</span> <span class="at">-f1-11</span> <span class="op">&gt;</span> chr22_with_ERCC92.refFlat.txt</span>
<span id="cb99-25"><a href="module-2.html#cb99-25" tabindex="-1"></a></span>
<span id="cb99-26"><a href="module-2.html#cb99-26" tabindex="-1"></a><span class="co"># Use the &quot;find&quot; command to run &quot;picard CollectRnaSeqMetrics&quot; on all 6 BAM files. </span></span>
<span id="cb99-27"><a href="module-2.html#cb99-27" tabindex="-1"></a><span class="co"># The basic structure of this kind of automation is: find &lt;search pattern&gt; -exec command {} \;</span></span>
<span id="cb99-28"><a href="module-2.html#cb99-28" tabindex="-1"></a><span class="co"># The &quot;{}&quot; will insert the file found by the &quot;find&quot; command using &lt;search pattern&gt;.  &quot;\;&quot; indicates the end of the command.</span></span>
<span id="cb99-29"><a href="module-2.html#cb99-29" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_HOME</span>/alignments/hisat2/</span>
<span id="cb99-30"><a href="module-2.html#cb99-30" tabindex="-1"></a><span class="fu">mkdir</span> picard</span>
<span id="cb99-31"><a href="module-2.html#cb99-31" tabindex="-1"></a><span class="fu">find</span> <span class="pp">*</span>Rep<span class="pp">*</span>.bam <span class="at">-exec</span> echo java <span class="at">-jar</span> <span class="va">$PICARD</span> CollectRnaSeqMetrics I={} O=picard/{}.RNA_Metrics REF_FLAT=<span class="va">$RNA_HOME</span>/refs/chr22_with_ERCC92.refFlat.txt STRAND=SECOND_READ_TRANSCRIPTION_STRAND RIBOSOMAL_INTERVALS=<span class="va">$RNA_HOME</span>/refs/ref_ribosome.interval_list <span class="dt">\;</span> <span class="kw">|</span> <span class="fu">sh</span></span></code></pre></div>
</div>
<div id="rseqc-optional" class="section level3 hasAnchor">
<h3>RSeQC [optional]<a href="module-2.html#rseqc-optional" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Background:</strong> RSeQC is a tool that can be used to generate QC reports for RNA-seq. For more information, please check: <a href="http://rseqc.sourceforge.net/">RSeQC Tool Homepage</a></p>
<p>Files needed:</p>
<ul>
<li>Aligned bam files</li>
<li>Index file for each bam file.</li>
<li>A transcript bed file (in bed12 format).</li>
</ul>
<div class="sourceCode" id="cb100"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb100-1"><a href="module-2.html#cb100-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_HOME</span>/refs/</span>
<span id="cb100-2"><a href="module-2.html#cb100-2" tabindex="-1"></a></span>
<span id="cb100-3"><a href="module-2.html#cb100-3" tabindex="-1"></a><span class="co"># Convert GTF to genePred</span></span>
<span id="cb100-4"><a href="module-2.html#cb100-4" tabindex="-1"></a><span class="ex">gtfToGenePred</span> chr22_with_ERCC92.gtf chr22_with_ERCC92.genePred</span>
<span id="cb100-5"><a href="module-2.html#cb100-5" tabindex="-1"></a></span>
<span id="cb100-6"><a href="module-2.html#cb100-6" tabindex="-1"></a><span class="co"># Convert genePred to BED12</span></span>
<span id="cb100-7"><a href="module-2.html#cb100-7" tabindex="-1"></a><span class="ex">genePredToBed</span> chr22_with_ERCC92.genePred chr22_with_ERCC92.bed12</span>
<span id="cb100-8"><a href="module-2.html#cb100-8" tabindex="-1"></a></span>
<span id="cb100-9"><a href="module-2.html#cb100-9" tabindex="-1"></a><span class="co"># Create a version of the BED12 with the ERCC92 sequences removed (because they confuse the QC analysis that looks at how many reads are coding, UTR, intronic, etc.</span></span>
<span id="cb100-10"><a href="module-2.html#cb100-10" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-v</span> ERCC chr22_with_ERCC92.bed12 <span class="op">&gt;</span> chr22_without_ERCC92.bed12</span>
<span id="cb100-11"><a href="module-2.html#cb100-11" tabindex="-1"></a></span>
<span id="cb100-12"><a href="module-2.html#cb100-12" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb100-13"><a href="module-2.html#cb100-13" tabindex="-1"></a><span class="fu">mkdir</span> rseqc</span>
<span id="cb100-14"><a href="module-2.html#cb100-14" tabindex="-1"></a><span class="ex">geneBody_coverage.py</span> <span class="at">-i</span> chr22_only_bams/UHR_Rep1.bam,chr22_only_bams/UHR_Rep2.bam,chr22_only_bams/UHR_Rep3.bam <span class="at">-r</span> <span class="va">$RNA_HOME</span>/refs/chr22_without_ERCC92.bed12 <span class="at">-o</span> rseqc/UHR</span>
<span id="cb100-15"><a href="module-2.html#cb100-15" tabindex="-1"></a><span class="ex">geneBody_coverage.py</span> <span class="at">-i</span> chr22_only_bams/HBR_Rep1.bam,chr22_only_bams/HBR_Rep2.bam,chr22_only_bams/HBR_Rep3.bam <span class="at">-r</span> <span class="va">$RNA_HOME</span>/refs/chr22_without_ERCC92.bed12 <span class="at">-o</span> rseqc/HBR</span>
<span id="cb100-16"><a href="module-2.html#cb100-16" tabindex="-1"></a></span>
<span id="cb100-17"><a href="module-2.html#cb100-17" tabindex="-1"></a><span class="co"># Calculate the inner distance of RNA-seq fragments. </span></span>
<span id="cb100-18"><a href="module-2.html#cb100-18" tabindex="-1"></a><span class="co">#              RNA fragment</span></span>
<span id="cb100-19"><a href="module-2.html#cb100-19" tabindex="-1"></a><span class="co">#  _________________||_________________</span></span>
<span id="cb100-20"><a href="module-2.html#cb100-20" tabindex="-1"></a><span class="co"># |                                    |</span></span>
<span id="cb100-21"><a href="module-2.html#cb100-21" tabindex="-1"></a><span class="co"># |                                    |</span></span>
<span id="cb100-22"><a href="module-2.html#cb100-22" tabindex="-1"></a><span class="co"># ||||||||||------------------||||||||||</span></span>
<span id="cb100-23"><a href="module-2.html#cb100-23" tabindex="-1"></a><span class="co">#   read_1    inner_distance    read_2</span></span>
<span id="cb100-24"><a href="module-2.html#cb100-24" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb100-25"><a href="module-2.html#cb100-25" tabindex="-1"></a><span class="co"># fragment size = read_1 + inner_distance + read_2</span></span>
<span id="cb100-26"><a href="module-2.html#cb100-26" tabindex="-1"></a><span class="fu">find</span> <span class="pp">*</span>Rep<span class="pp">*</span>.bam <span class="at">-exec</span> echo inner_distance.py <span class="at">-i</span> {} <span class="at">-r</span> <span class="va">$RNA_HOME</span>/refs/chr22_without_ERCC92.bed12 <span class="at">-o</span> rseqc/{} <span class="dt">\;</span> <span class="kw">|</span> <span class="fu">sh</span></span>
<span id="cb100-27"><a href="module-2.html#cb100-27" tabindex="-1"></a></span>
<span id="cb100-28"><a href="module-2.html#cb100-28" tabindex="-1"></a><span class="co"># Annotate exon-exon junctions observed in RNA-seq alignments compared to know exon-exon junctions</span></span>
<span id="cb100-29"><a href="module-2.html#cb100-29" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span>/chr22_only_bams</span>
<span id="cb100-30"><a href="module-2.html#cb100-30" tabindex="-1"></a><span class="fu">find</span> <span class="pp">*</span>Rep<span class="pp">*</span>.bam <span class="at">-exec</span> echo junction_annotation.py <span class="at">-i</span> {} <span class="at">-r</span> <span class="va">$RNA_HOME</span>/refs/chr22_without_ERCC92.bed12 <span class="at">-o</span> ../rseqc/{} <span class="dt">\;</span> <span class="kw">|</span> <span class="fu">sh</span></span>
<span id="cb100-31"><a href="module-2.html#cb100-31" tabindex="-1"></a></span>
<span id="cb100-32"><a href="module-2.html#cb100-32" tabindex="-1"></a><span class="co"># Perform a saturation analysis using only exon-exon junction mapping reads</span></span>
<span id="cb100-33"><a href="module-2.html#cb100-33" tabindex="-1"></a><span class="fu">find</span> <span class="pp">*</span>Rep<span class="pp">*</span>.bam <span class="at">-exec</span> echo junction_saturation.py <span class="at">-i</span> {} <span class="at">-r</span> <span class="va">$RNA_HOME</span>/refs/chr22_without_ERCC92.bed12 <span class="at">-o</span> ../rseqc/{} <span class="dt">\;</span> <span class="kw">|</span> <span class="fu">sh</span></span>
<span id="cb100-34"><a href="module-2.html#cb100-34" tabindex="-1"></a></span>
<span id="cb100-35"><a href="module-2.html#cb100-35" tabindex="-1"></a><span class="co"># Determine the distribution of reads with respect to the parts of transcripts they align to (e.g. 5&#39; UTR, CDS, 3&#39;UTR, intron, etc.)</span></span>
<span id="cb100-36"><a href="module-2.html#cb100-36" tabindex="-1"></a><span class="fu">find</span> <span class="pp">*</span>Rep<span class="pp">*</span>.bam <span class="at">-exec</span> echo read_distribution.py  <span class="at">-i</span> {} <span class="at">-r</span> <span class="va">$RNA_HOME</span>/refs/chr22_without_ERCC92.bed12 <span class="dt">\&gt;</span> ../rseqc/{}.read_dist.txt <span class="dt">\;</span> <span class="kw">|</span> <span class="fu">sh</span></span>
<span id="cb100-37"><a href="module-2.html#cb100-37" tabindex="-1"></a></span>
<span id="cb100-38"><a href="module-2.html#cb100-38" tabindex="-1"></a><span class="co"># Calculate the RNA fragment sizes and produce statistics for each transcript</span></span>
<span id="cb100-39"><a href="module-2.html#cb100-39" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb100-40"><a href="module-2.html#cb100-40" tabindex="-1"></a><span class="fu">find</span> <span class="pp">*</span>Rep<span class="pp">*</span>.bam <span class="at">-exec</span> echo RNA_fragment_size.py <span class="at">-i</span> {} <span class="at">-r</span> <span class="va">$RNA_HOME</span>/refs/chr22_without_ERCC92.bed12 <span class="dt">\&gt;</span> rseqc/{}.frag_size.txt <span class="dt">\;</span> <span class="kw">|</span> <span class="fu">sh</span></span>
<span id="cb100-41"><a href="module-2.html#cb100-41" tabindex="-1"></a></span>
<span id="cb100-42"><a href="module-2.html#cb100-42" tabindex="-1"></a><span class="co"># Summarizing mapping statistics of each BAM file</span></span>
<span id="cb100-43"><a href="module-2.html#cb100-43" tabindex="-1"></a><span class="fu">find</span> <span class="pp">*</span>Rep<span class="pp">*</span>.bam <span class="at">-exec</span> echo bam_stat.py <span class="at">-i</span> {} <span class="dt">\&gt;</span> rseqc/{}.bam_stat.txt <span class="dt">\;</span> <span class="kw">|</span> <span class="fu">sh</span></span>
<span id="cb100-44"><a href="module-2.html#cb100-44" tabindex="-1"></a></span>
<span id="cb100-45"><a href="module-2.html#cb100-45" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-f</span> log.txt</span></code></pre></div>
</div>
<div id="multiqc-1" class="section level3 hasAnchor">
<h3>MultiQC<a href="module-2.html#multiqc-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will now use multiQC to compile a QC report from all the QC tools above.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb101-1"><a href="module-2.html#cb101-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span></span>
<span id="cb101-2"><a href="module-2.html#cb101-2" tabindex="-1"></a><span class="ex">multiqc</span> ./</span></code></pre></div>
<div id="multiqc-screenshot" class="section level5 hasAnchor">
<h5>MultiQC screenshot<a href="module-2.html#multiqc-screenshot" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="float">
<img src="assets/module_2/multiqc.png" alt="MultiQC" />
<div class="figcaption">MultiQC</div>
</div>
</div>
</div>
<div id="view-a-pre-generated-multiqc-report-for-full-bam-files" class="section level3 hasAnchor">
<h3>View a pre-generated MultiQC report for full bam files<a href="module-2.html#view-a-pre-generated-multiqc-report-for-full-bam-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>View a multiQC on QC reports from non-downsampled bam files:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb102-1"><a href="module-2.html#cb102-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="va">$RNA_ALIGN_DIR</span>/example_QC</span>
<span id="cb102-2"><a href="module-2.html#cb102-2" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_ALIGN_DIR</span>/example_QC</span>
<span id="cb102-3"><a href="module-2.html#cb102-3" tabindex="-1"></a><span class="fu">wget</span> http://genomedata.org/rnaseq-tutorial/multiqc_report.html</span></code></pre></div>
<p>Below is a brief description of each of the samples included in the multiQC report.</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>Sample type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Sample 1</td>
<td>Brain metastasis</td>
</tr>
<tr class="even">
<td>Sample 2</td>
<td>Melanoma xenograft</td>
</tr>
<tr class="odd">
<td>Sample 3</td>
<td>Melanoma cell line</td>
</tr>
<tr class="even">
<td>Sample 4</td>
<td>Melanoma</td>
</tr>
<tr class="odd">
<td>Sample 5</td>
<td>Small Cell Lung Cancer FFPE</td>
</tr>
<tr class="even">
<td>Sample 6</td>
<td>Brain metastasis</td>
</tr>
</tbody>
</table>
<p>The goal of the following team assignment is for students to gain hands-on experience by working on recently published RNA-seq data and apply the concepts they have learned up to RNA alignment. To complete this assignment, students will need to review commands we performed in earlier sections.</p>
<p><strong>Background on Dataset used</strong></p>
<p>In this assignment, we will be using subsets of the GSE136366 dataset (Roczniak-Ferguson A, Ferguson SM. Pleiotropic requirements for human TDP-43 in the regulation of cell and organelle homeostasis. Life Sci Alliance 2019 Oct;2(5). PMID: 31527135). This dataset consists of 6 RNA sequencing files of human cells that either express or lack the TDP-43 protein.</p>
<p><strong>Experimental Details</strong>
- The libraries are prepared as paired end.
- The samples are sequenced on an Illumina HiSeq 2500.
- Each read is 63 bp long
- The data are RF/fr-firststrand stranded (dUTP)
- The source dataset is located here: <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE136366">GSE136366</a>
- 3 samples are from TDP-43 Knockout HeLa cells and 3 samples wherein a wildtype TDP-43 transgene was re-expressed.
- For this exercise we will be using different subsets of the reads:
- Team A: chr11
- Team B: chr12
- Team C: chr17
- Team D: chr19
- Team E: chr6
- The files are named based on their SRR id’s, and obey the following key:
- SRR10045016 = KO sample 1
- SRR10045017 = KO sample 2
- SRR10045018 = KO sample 3
- SRR10045019 = Rescue sample 1
- SRR10045020 = Rescue sample 2
- SRR10045021 = Rescue sample 3</p>
</div>
<div id="part-i---obtaining-the-dataset-reference-files" class="section level3 hasAnchor">
<h3>Part I - Obtaining the dataset &amp; reference files<a href="module-2.html#part-i---obtaining-the-dataset-reference-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Goals:</strong></p>
<ul>
<li>Obtain the files necessary for data processing</li>
<li>Review reference and annotation file formats</li>
<li>Review sequence FASTQ format</li>
</ul>
<p>As mentioned previously, we have subsetted the 6 RNA-seq samples into 5 different chromosome regions. Each team can download their corresponding dataset using the following commands.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb103-1"><a href="module-2.html#cb103-1" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_HOME</span>/</span>
<span id="cb103-2"><a href="module-2.html#cb103-2" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> team_exercise/untrimmed</span>
<span id="cb103-3"><a href="module-2.html#cb103-3" tabindex="-1"></a><span class="bu">cd</span> team_exercise/untrimmed</span>
<span id="cb103-4"><a href="module-2.html#cb103-4" tabindex="-1"></a></span>
<span id="cb103-5"><a href="module-2.html#cb103-5" tabindex="-1"></a><span class="co"># Fill in the &quot;XX&quot; below with your team&#39;s letter (A, B, C...)</span></span>
<span id="cb103-6"><a href="module-2.html#cb103-6" tabindex="-1"></a><span class="fu">wget</span> <span class="at">-c</span> http://genomedata.org/seq-tec-workshop/read_data/rna_alignment-de_exercise/dataset_XX/dataset.tar.gz</span>
<span id="cb103-7"><a href="module-2.html#cb103-7" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xzvf</span> dataset.tar.gz</span></code></pre></div>
<p>Additionally, teams will need to create a separate directory and download the corresponding reference files needed for RNA alignment &amp; further expression analysis. Don’t forget to modify the below commands to <strong>use your team’s chromosome</strong>.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb104-1"><a href="module-2.html#cb104-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$RNA_HOME</span>/team_exercise/references</span>
<span id="cb104-2"><a href="module-2.html#cb104-2" tabindex="-1"></a><span class="bu">cd</span> <span class="va">$RNA_HOME</span>/team_exercise/references</span>
<span id="cb104-3"><a href="module-2.html#cb104-3" tabindex="-1"></a></span>
<span id="cb104-4"><a href="module-2.html#cb104-4" tabindex="-1"></a><span class="co">## Adapter trimming</span></span>
<span id="cb104-5"><a href="module-2.html#cb104-5" tabindex="-1"></a><span class="fu">wget</span> <span class="at">-c</span> http://genomedata.org/seq-tec-workshop/references/RNA/illumina_multiplex.fa</span>
<span id="cb104-6"><a href="module-2.html#cb104-6" tabindex="-1"></a></span>
<span id="cb104-7"><a href="module-2.html#cb104-7" tabindex="-1"></a><span class="co">## Reference fasta corresponding to your team&#39;s assigned chromosome (e.g. chr6)</span></span>
<span id="cb104-8"><a href="module-2.html#cb104-8" tabindex="-1"></a><span class="fu">wget</span> <span class="at">-c</span> http://genomedata.org/seq-tec-workshop/references/RNA/chrXX.fa</span>
<span id="cb104-9"><a href="module-2.html#cb104-9" tabindex="-1"></a></span>
<span id="cb104-10"><a href="module-2.html#cb104-10" tabindex="-1"></a><span class="co">## Obtain annotated reference gtf file corresponding to your team&#39;s assigned chromosome (e.g. chr6)</span></span>
<span id="cb104-11"><a href="module-2.html#cb104-11" tabindex="-1"></a><span class="fu">wget</span> <span class="at">-c</span> http://genomedata.org/seq-tec-workshop/references/RNA/chrXX_Homo_sapiens.GRCh38.95.gtf</span></code></pre></div>
</div>
<div id="part-ii---data-preprocessing-qc-trimming" class="section level3 hasAnchor">
<h3>Part II - Data Preprocessing (QC &amp; Trimming)<a href="module-2.html#part-ii---data-preprocessing-qc-trimming" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Goals:</strong></p>
<ul>
<li>Perform adapter trimming on your data and also pre-trim 5 bases from <strong>end (right)</strong> of reads</li>
<li>Perform QC on your data with <code>fastqc</code> and <code>multiqc</code> before and after trimming your data</li>
</ul>
<p><strong>Q1.</strong> What is the average percentage of reads that are trimmed?</p>
<p><strong>Q2.</strong> How do you expect the sequence length distribution to look prior to and after trimming? Is your answer confirmed by the multiqc report results?</p>
<p><strong>Q3.</strong> Are there any metrics where the sample(s) failed?</p>
</div>
<div id="part-iii---alignment" class="section level3 hasAnchor">
<h3>Part III - Alignment<a href="module-2.html#part-iii---alignment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Goals:</strong></p>
<ul>
<li>Create HISAT2 index files <strong>for your chromosome</strong></li>
<li>Review HISAT2 alignment options</li>
<li>Perform alignments</li>
<li>Obtain an alignment summary</li>
<li>Sort and convert your alignments into compressed BAM format</li>
</ul>
<p><em>A useful option to add to the end of your commands is <code>2&gt;</code>, which redirects the stderr from any command into a specific file. This can be used to redirect your stderr into a summary file, and can be used as follows: <code>my_alignment_command 2&gt; alignment_metrics.txt</code>. The advantage of this is being able to view the alignment metrics later on.</em></p>
<p><strong>Q4.</strong> What were the percentages of reads that aligned to the reference for each sample?</p>
<p><strong>Q5.</strong> By compressing your sam format to bam, approximately how much space is saved (fold change in size)?</p>
</div>
<div id="part-iv---post-alignment-qc-igv-visualization" class="section level3 hasAnchor">
<h3>Part IV - Post-alignment QC &amp; IGV Visualization<a href="module-2.html#part-iv---post-alignment-qc-igv-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Goals:</strong></p>
<ul>
<li>Perform post-alignment QC analysis using <code>fastqc</code> and <code>multiqc</code></li>
<li>Merge bam files (one for each condition) for easier visualization in IGV</li>
<li>Index the bam files</li>
<li>Explore the alignments using IGV</li>
</ul>
<p><strong>Q6.</strong> How does the information from your post-alignment QC report differ from pre-alignment QC?</p>
<p><strong>Q7.</strong> IGV: Can you identify certain exons that have significantly more/less coverage in one of your KO/RESCUE samples compared to the other? What is happening here?</p>
<p><strong>Q8.</strong> IGV: Can you identify regions where the RNAseq reads are mapping to unexpected regions? What do you think is the reason for this phenomenon?</p>
<p><strong>Q9.</strong> IGV: Can you identify a gene region that has RNA sequencing support for multiple isoforms?</p>
</div>
<div id="presenting-your-results" class="section level3 hasAnchor">
<h3>Presenting Your Results<a href="module-2.html#presenting-your-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>At the end of this team exercise, groups will present findings from their QC reports and IGV analysis to the class for specific questions listed below.</p>
<p>Team A: Present IGV findings regarding question 9.</p>
<p>Team B: Present multiqc report on pre- and post-alignment qc files (question 6).</p>
<p>Team C: Present IGV findings regarding question 7.</p>
<p>Team D: Present IGV findings regarding question 8.</p>
<p>Team E: Present multiqc report on pre- and post-trimming qc files (Data Preprocessing section).</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="module-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="module-3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/bioinformaticsdotca/RNA_2025/blob/main/020-module-2.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
